<!DOCTYPE html>
<html>
  <head>
		<script>
		  !function(f,b,e,v,n,t,s)
		  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
		  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
		  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
		  n.queue=[];t=b.createElement(e);t.async=!0;
		  t.src=v;s=b.getElementsByTagName(e)[0];
		  s.parentNode.insertBefore(t,s)}(window, document,'script',
		  'https://connect.facebook.net/en_US/fbevents.js');
		  fbq('init', '2191057757678582');
		  fbq('track', 'PageView');


		</script>
		<noscript><img height="1" width="1" style="display:none"
		  src="https://www.facebook.com/tr?id=2191057757678582&ev=PageView&noscript=1"
		/></noscript>
   <meta charset="UTF-8">
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-PZVJQSC2BL"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-PZVJQSC2BL');
      </script>

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	</script>
	<script>ga('create', 'UA-21603124-1', 'auto');</script>
<script>ga('set', 'dimension1', 'anonymous');</script><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/bootstrap/bootstrap.css?v=1.2.5.2" type="text/css" media=" "/>
<link rel="stylesheet" href="/css/fontawesome-free-5.0.9/web-fonts-with-css/css/fontawesome-all.min.css?v=1.2.5.2" type="text/css" media=" "/>
<link rel="stylesheet" href="/css/style2.css?v=1.2.5.2" type="text/css" media=" "/><script type="text/javascript" src="/js/jquery-3.5.1.min.js" ></script>
				<link rel="stylesheet" href="/css/lightbox/css/lightbox.css?v=1">
				<script type="text/javascript" src="/css/lightbox/js/lightbox.js" ></script>
				<script type="text/javascript" src="/js/jquery-ui-1.13.2.min.js" async></script><title>Team BlackSheep - Serious Toys</title>
			<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
			<meta name="description" content="" />
			<meta name="keywords" content="FPV, Zephyr, EzUHF, Ritewing, EzOSD, Team BlackSheep, BlackSheep, trappy, RiSCyD, perna, fpv video, rtf aircraft, quadcopter, quadrotor, quad, discovery" />
		</head>
		<body>
		<div id="login"><form method="post" action="/"><input type="hidden" name="a" value="login"><input type="hidden" name="action" value="loginUser"><input type="hidden" name="ref" value="shop" /><table cellspacing=0 cellpadding=0 id="login_divider"><tr><td><label for="user">Email:</label></td><td><label for="pass">Password:</label></td><td rowspan=2 valign="bottom"><input type="submit" value="Log in" /></td></tr><tr><td><input type="text" name="user" id="user" /></td><td><input type="password" name="pass" id="pass" /></td></tr><tr><td><a style="color:white;font-size:75%" href="#" id="forgotpass">Forgot Password</a></td></tr></table></form></div><script type="text/javascript">$(document).ready(function() {
				$('#header_bar a.login').click(function(e){
					e.preventDefault();
					$('#forgot_password_form').remove();
					$('#login').css(login_setting);
					$('#login').toggle();
				//}).mouseover(function() {
				//	$('#login').toggle(false);
				});

			});</script><div>						<div id="fb-root"></div>
		<span id="global_wrapper">
		<div id="header" class="d-none d-md-block">
			<a href="/"><div id="header_navigation" class="content align_center">
			</div></a>
		</div>

<!-- Desktop top menu -->        
	<div id="top_navigation_new" class="d-none d-md-block bg-black">
		<div id="header_bar_new" class="content">
			<nav class="navbar navbar-expand-sm navbar-dark bg-black">
				<ul class="navbar-nav mr-auto">

		<li class='nav-item mr-2'><a href="/" class="nav-link active" >HOME</a></li><li class='nav-item mr-2'><a href="/shop" class="nav-link" >SHOP</a></li><li class='nav-item mr-2'><a href="/simulator" class="nav-link" >SIMULATOR</a></li><li class='nav-item mr-2'><a href="https://www.facebook.com/groups/BlackSheepLOUNGE/" class="nav-link" target="_blank" >COMMUNITY</a></li><li class='nav-item mr-2'><a href="//team-blacksheep.freshdesk.com/support/home" class="nav-link" target="_blank" >CONTACT</a></li><li class='nav-item mr-2'><a href="/download/" class="nav-link" >DOWNLOAD</a></li><li class='nav-item mr-2'><a href="javascript:showPanel('collapseSearch');" class="nav-link" >SEARCH</a></li><li class='nav-item mr-2'><a href="javascript:showPanel('collapseLogin');" class="nav-link" >LOGIN</a></li>	
					<!--
						<form class="form-inline my-2 my-lg-0">
							<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
							<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Go</button>
						</form>
					-->
				</ul>
				
				<ul class="navbar-nav">
					<a data-toggle="collapse" href="#collapseCart" role="button" aria-expanded="false" aria-controls="collapseCart">
						<div id="mini_cart" class="navbar-nav float-xs-right">
							0 items<br />
							<div class="total">US$ 0.00</div>
						</div>
					</a>
				</ul>
			</nav>
		</div>
	</div>
<!-- END Desktop top menu -->

<!-- Mobile top menu -->
	<nav class="navbar navbar-default fixed-top bg-black d-md-none">
		<div class="navbar-form navbar-left">
			<a class="" href="#"><i class="fas fa-bars fa-lg text-white" id="sidebarCollapse"></i></a>
			<a data-toggle="collapse" href="#collapseSearch" role="button" aria-expanded="false" aria-controls="collapseSearch"><i class="fas fa-search fa-lg px-2 text-white"></i></a>
		</div>
		<div>
			<a class="" href="/"><img src="/img/tbs_logo_mobile.svg" alt="" width="50"></a>
		</div>
		<div class="navbar-form navbar-right">
			<a data-toggle="collapse" href="#collapseLogin" role="button" aria-expanded="false" aria-controls="collapseLogin"><i class="far fa-user fa-lg px-2 text-white"></i></a>
			<a data-toggle="collapse" href="#collapseCart" role="button" aria-expanded="false" aria-controls="collapseCart"><div class="fas fa-shopping-cart fa-lg text-white has-badge" data-count="0" id="cart_qty"></div></a>
		</div>
	</nav>
	<div class="d-md-none nav-height">
	</div>
<!-- END Mobile top menu -->

<!-- All panel place here! -->
<div id="allPanel" class="all-panel fixed-top">
	<!-- search panel -->
	<div class="collapse bg-black" id="collapseSearch" data-parent="#allPanel">
		<div class="card card-body bg-secondary">
			<div class="row">
				<div class="float-left col">
					<style type="text/css"></style><div><input type="search" placeholder='SEARCH' id="search" autocomplete='off' value=''></div><script type="text/javascript">function r(f){/in/.test(document.readyState)?setTimeout(r,9,f):f()}
r(function(){
	
$(document).ready(function() {
	$.autocomplete = function() { };
	jQuery.loadScript = function (url, callback) {
	    jQuery.ajax({
	        url: url,
	        dataType: 'script',
	        success: callback,
	        async: true
	    });
	}

	
	$('#search').keydown(function(e) {
		var term = $('#search').val();
		if((e.keyCode === 13 || e.which === 13)){
			if(term.length > 1){
				$('ul.ui-autocomplete').hide();
				$('ul.ui-autocomplete').addClass('ui-autocomplete-loading');
				/*
				if($(window).width() < 600){ // Jump the screen to the product listing on mobile
					base = window.location.href.substring(0,(window.location.href.indexOf("/shop")+5));
					window.location.href = base + "#product_listing";
				}
				*/
				if($(location).attr('pathname').indexOf("shop") >= 0) {
					history.pushState("", '', '/shop/q:' + term);
					setTimeout(function(){
						$.post(CMS_AJAX_URL, {'action':'show-results','a': 'shopnav','term': term}, function(r) {
								$('div#product_detail').empty();
								$('div#product_detail').attr('id', 'product_listing');
								$('div#product_listing').html(r.html);
								$('ul.ui-autocomplete').hide();
						}, "json");
						$('ul.ui-autocomplete').removeClass('ui-autocomplete-loading');
					}, 300);
					closeCollapse();
				} else {
					$(location).attr('href', '/shop/q:' + term);
				}
				return false;
			} 
			return false;
		}
	});
	
	//Load the jquery-ui after everything's ready
	//$.loadScript('//code.jquery.com/ui/1.11.4/jquery-ui.min.js', function(){
		$(function() {
			$("#search").autocomplete({
		        source: "/autocomplete.php",
		        minLength: 2,
				delay: 500,
		        select: function(event, ui) {
		            var url = ui.item.url;
		            if(url != '#') {
		               	console.log(url);
						//Change this url finder to link to the correct next page
						//window.location.href = window.location.href.substring(0,window.location.href.indexOf(".com/")+5) + '' + url;
						$(location).attr('href', '/' + url);
		            }
		        },
		 
		        html: true, //(jquery.ui.autocomplete.html.js required)
		        open: function(event, ui) {
		            $(".ui-autocomplete").css("z-index", 9999);
					$('ul.ui-autocomplete').hide().slideDown() 
		        },
				close: function () { 
					$('ul.ui-autocomplete').show().slideUp() 
				}
		    });
		});
		/*
		* jQuery UI Autocomplete HTML Extension
		*/
			(function( $ ) {
				
				var proto = $.ui.autocomplete.prototype,
				initSource = proto._initSource;
				
				function filter( array, term ) {
				var matcher = new RegExp( $.ui.autocomplete.escapeRegex(term), "i" );
				return $.grep( array, function(value) {
					return matcher.test( $( "<div>" ).html( value.label || value.value || value ).text() );
				});
				}
				
				$.extend( proto, {
				_initSource: function() {
					if ( this.options.html && $.isArray(this.options.source) ) {
						this.source = function( request, response ) {
							response( filter( this.options.source, request.term ) );
						};
					} else {
						initSource.call( this );
					}
				},
				
				_renderItem: function( ul, item) {
					return $( "<li></li>" )
						.data( "item.autocomplete", item )
						.append( $( "<a></a>" )[ this.options.html ? "html" : "text" ]( item.label ) )
						.appendTo( ul );
				}
				});
		})( jQuery );
	//});
});

});
</script>				</div>
				<div class="float-right text-right">
					<a data-toggle="collapse" href="#collapseSearch" role="button" aria-expanded="false" aria-controls="collapseSearch">
						<i class="far fa-times-circle fa-lg text-white"></i>
					</a>
				</div>
			</div>
		</div>
	</div>
	<!-- END search panel -->


	<!-- login panel -->
	<div class="collapse bg-black" id="collapseLogin" data-parent="#allPanel">
		<div class="card card-body bg-secondary">
			<div class="row">
				<div class="float-left col" id="regContent">
											<ul class="nav nav-tabs" id="cusTab" role="tablist">
						  <li class="nav-item">
						    <a class="nav-link active" id="login-tab" data-toggle="tab" href="#loginTab" role="tab" aria-controls="loginTab" aria-selected="true">Login</a>
						  </li>
						  <li class="nav-item">
						    <a class="nav-link" id="register-tab" data-toggle="tab" href="#registerTab" role="tab" aria-controls="registerTab" aria-selected="false">Register</a>
						  </li>
						</ul>
						<div class="tab-content" id="cusTabContent">
							<div class="tab-pane fade show active mt-2" id="loginTab" role="tabpanel" aria-labelledby="login-tab">
								<form method="post" action="/">
									<input type="hidden" name="a" value="login">
									<input type="hidden" name="action" value="loginUser">
									<input type="hidden" name="ref" value="shop" />									<div id="login_divider">
										<div class="form-group">
											<label for="user">Email:</label>
											<input type="email" class="form-control" name="user" id="user" aria-describedby="emailHelp" placeholder="Enter email" required>
										</div>
										<div class="form-group">
											<label for="pass">Password</label>
											<input type="password" class="form-control" name="pass" id="pass" placeholder="Password" required>
										</div>
										<div class="float-left">
											<a data-toggle="collapse" href="#collapseForgotPassword" role="button" aria-expanded="false" aria-controls="collapseForgotPassword" required>
												<small id="emailHelp" class="form-text">Forgot Password</small>
											</a>
										</div>
										<div class="float-right"><button type="submit" class="btn btn-primary">Submit</button></div>
									</div>
								</form>
							</div>
							<div class="tab-pane fade mt-2" id="registerTab" role="tabpanel" aria-labelledby="register-tab">
								<form method="post" action="/" id="regForm">
									<input type="hidden" name="a" value="login">
									<input type="hidden" name="action" value="registerCustomer">
									<input type="hidden" name="ref" value="shop" />									<div id="login_divider">
										<div class="form-group">
											<label for="user">Email:</label>
											<input type="email" class="form-control" name="user" id="user" aria-describedby="emailHelp" placeholder="Your email" required>
											<div id="regAlert" class="text-warning"></div>
										</div>
										<div class="form-group">
											<label for="pass">Password</label>
											<input type="password" pattern="\S{8,20}" class="form-control" name="pass" id="pass" placeholder="Your password" required>
											<small id="emailHelp" class="form-text">8-20 characters, no space</small>
										</div>
										<div class="float-right"><button type="submit" id="btn_reg" class="btn btn-primary">Submit</button></div>
									</div>
								</form>
							</div>
						</div>
									</div>
				<div class="float-right text-right">
					<a data-toggle="collapse" href="#collapseLogin" role="button" aria-expanded="false" aria-controls="collapseLogin">
						<i class="far fa-times-circle fa-lg text-white"></i>
					</a>
				</div>
			</div>
		</div>
	</div>
	<!-- END login panel -->
	<script type="text/javascript">
		$('#regForm').submit(function(e) {
			e.preventDefault();
			regFormFetch();
		});

		function regFormFetch() {
			var user = $('#regForm input#user').val();
			var pass = $('#regForm input#pass').val();
			var result = $.post(CMS_AJAX_URL, {'a': 'login', 'action': 'registerCustomer', 'user': user, 'pass': pass}, function(r) {
				if (r.success == false || r.success == "false") {
					$('#regAlert').html('This email already register.');
				} else if (r.success == "invalid") {
					$('#regAlert').html('Invalid email or password.');
				} else {
					$('#regContent').html('Registered.');
				}
			}, "json");
		}
	</script>

	<!-- forgot password panel -->
	<div class="collapse bg-black" id="collapseForgotPassword" data-parent="#allPanel">
		<div class="card card-body bg-secondary">
			<div class="row">
				<div class="float-left col" id="forgotPwContent">
					<form id="forgot_password_form" action="/">
						<div id="login_divider">
							<div class="form-group">
								<label for="forgotemail">Email:</label>
								<input type="email" class="form-control" name="forgotemail" id="forgotemail" aria-describedby="emailHelp" placeholder="Enter email" required>
							</div>
							<div class="float-right"><button type="submit" id="btn_forgot_pw" class="btn btn-primary">Send Reset Instructions</button></div>
						</div>
					</form>
					<div id="forgotPwAlert"></div>
				</div>
				<div class="float-right text-right">
					<a data-toggle="collapse" href="#collapseForgotPassword" role="button" aria-expanded="false" aria-controls="collapseForgotPassword" id="closeForgotPasswordPanel">
						<i class="far fa-times-circle fa-lg text-white"></i>
					</a>
				</div>
			</div>
		</div>
	</div>
	<!-- END forgot password panel -->
	<script type="text/javascript">
		$('#forgot_password_form').submit(function(e) {
			e.preventDefault();
			forgotPasswordFormFetch();
		});

		$('#closeForgotPasswordPanel').click(function() {
			resetForgotPwContent();
		});
		
		function forgotPasswordFormFetch() {
			var email = $('#forgot_password_form input#forgotemail').val();
			var result = $.post(CMS_AJAX_URL, {'a': 'login', 'action': 'sendresetemail', 'email': email}, function(r) {
				if (r.success == false || r.success == "false") { //email server issue
					$('#forgotPwAlert').html('Processing...');
				} else {
					$('#forgotPwContent').html('The instruction has been sent.');
				}

			}, "json");
		}

		function resetForgotPwContent() {
			$('#forgotPwContent').html('<form id="forgot_password_form" action="/"><div id="login_divider"><div class="form-group"><label for="email">Email:</label><input type="email" class="form-control" name="forgotemail" id="forgotemail" aria-describedby="emailHelp" placeholder="Enter email" required></div><div class="float-right"><button type="button" id="btn_forgot_pw" class="btn btn-primary">Send Reset Instructions</button></div></div></form><div id="forgotPwAlert"></div>');
		}
	</script>


	<!-- mini-cart panel -->
	<div class="collapse bg-black" id="collapseCart" data-parent="#allPanel">
		<div class="card card-body cart-panel-body bg-secondary" id="collapseCartBody">
			<div class="float-right">
			<div class="row mb-3">
				<div class="float-left col">
				</div>
				<div class="float-right text-right">
					<a data-toggle="collapse" href="#collapseCart" role="button" aria-expanded="false" aria-controls="collapseCart">
						<i class="far fa-caret-square-up fa-lg text-white"></i>
					</a>
									</div>
			</div>
			<div class="cart-panel p-1 obj-scroll-body-not">
				<div class="float-left col m-0 p-0">
					<div class="navbar-nav float-xs-right">
						<style type="text/css">input[type=checkbox].css-checkbox {
							position:absolute; z-index:-1000; left:-1000px; overflow: hidden; clip: rect(0 0 0 0); height:1px; width:1px; margin:-1px; padding:0; border:0;
						}

						input[type=checkbox].css-checkbox + label.css-label {
							padding:5px 0px 0px 22px;
							height:12px !important; 
							display:inline-block !important;
							line-height:7px;
							background-repeat:no-repeat;
							background-position: 0 0;
							font-size:17px;
							vertical-align:middle;
							cursor:pointer;

						}

						input[type=checkbox].css-checkbox:checked + label.css-label {
							background-position: 0 -17px; 
						}
						label.css-label {
				background-image:url(/images/csscheckbox_5a434cea96474c90a74625b4bfe6f142.png);
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
.ui-effects-transfer { border: 2px solid white; }
form.addToCart input.quantity {
	width: 50px;
	margin-right: 15px;
}
div.totalExplanation {
	font-size: 0.8em;
}
img.messaging_hide {
	cursor: pointer;
}
ul.date-list li.hidden {
	color: #666;
}
.checkoutContainer img.cartDelProduct {
	display: none;
}

form.checkout input , form.checkout select {
    margin-bottom: 14px;
    width: 250px;
}
form.checkout input.autosize {
    width: auto;
}
form.checkout input#submit {
	width: auto;
}

form.checkout label {

}

form.checkout ul li em {
	float: right;
}
div.refund-button, div.refund-item-button {
	height: 16px;
	width: 16px;
	display: none;
	float: left;
	background: transparent url('/img/icons/cancel.png');
}

#self-declaration {
	display: none;
	margin-left: 15px;
	margin-top: 50px;
}
#cart-modifiers {
	display: block;
	margin-left: 15px;
	margin-top: 40px;
	margin-bottom: 60px;
}
#cart-modifiers > a {
	float: left;
}
#cart-modifiers > a.admin-split-exec {
	display: none;
	background: green;
}
#edit-address {
	display: none;
}
.exec-edit-address {
	display: none;
}
div#pause{
	display: none;
	position: fixed;
	height: 400px;
	width: 400px;
	left: 50%;
	top: 50%;
	margin-left: -200px;
	margin-top: -200px;
	background: rgba(0,0,0,0.8) url('/img/ajaxloading.gif') no-repeat fixed center;
	z-index: 999;
	text-align: center;
	line-height: 200px;
	border: 2px solid #999; 
}

#new_total {
	color: #388FB9;
	font-weight: bolder;
	left: 331px;
	position: relative;
	top: -17px;
}

#save-declared-value {
	left: 70px;
	position: relative;
	top: -35px;
	cursor: pointer;
}
.recalculation {
    color: white;
    list-style: outside none none;
}
.recalculate-shipping{
	min-width: 200px;
}
textarea.messaging{
	border-radius: 10px;
    display: block;
    margin: 0 auto;
    padding: 2%;
    width: 90%;
}
.admin{
	background: #333;
}
.customer{
	background: #000 ;
}
ul.date-list{
	list-style: none;
	padding: 0;
}
.date-list li{
	border-radius: 10px;
    margin: 2% 0;
    padding: 1px 10px;
}

.btn {
    background-color: #99ccff;
    padding: 0px 11px;
    cursor: pointer;
    color: black;
    border-radius: 5px;
    font-size: 12px;
}

a.confirmorder, a.payment.paypal, a.payment.coinbase{
    padding: 7px 2% 7px !important;
}
.recalculating{
	top: -110px;
    max-width: 500px;
}	
.green.small{
	font-size: 7pt;
}
span#checkout span#li.totalhook, span#checkout span#li.finalhook {
	height: 85px;
}
.table_payments {
	table-layout:auto;
	cell-padding:3;	
	width:100%;

	background-color:black; 
	border-collapse: collapse; 
	font-size: 85%;
}
.table_payments tr, .table_payments td, .table_payments th {
	border: 1px solid grey;
	font-weight: 100;
	padding: 3px;
	height: 50px;
	align: center;
}
.table_payments th {
  	background-color: #000080;
  	font-size: 125%;
}
.highlight {
	background-color: #222;
	cursor:pointer;
}
.selected {
	background-color: #333;
	cursor:pointer;
}
.highlight-color-purple {
	background-color: #673AB7!important;
}</style><div id="global_cart"><div>
						<div class="text-center">
							Your cart is empty.
						</div>
					</div></div><script type="text/javascript">$(document).ready(function() {
	var order_id = $('#oid').val();
	$(document).on('click', 'img.messaging_hide',
		function() {
			var $this = $(this);
			var id = $this.attr('x-id');
			$.post(CMS_AJAX_URL, {'action':'hidemsg','a': 'cart','id': id},
				function(r) {
					var li = $this.parents('li:first');

					if (li.hasClass("hidden")) {
						li.removeClass("hidden");
					} else {
						li.addClass("hidden");
					}
				}
			,"json");
		}
	);

	$('form.addToCart').submit(function(e) {
		e.stopPropagation();
		var id , variations , vars = [], qty;

		id = $('.product',$(this)).val();
		qty = $('.qty',$(this)).val();

		$('.variationCheckbox').each(function() {
			if ($(this).is(':checked')) {
				vars.push({id: $(this).attr('x-variation-id')});
			}
		});

		$.post(CMS_AJAX_URL, {'action':'add','a': 'cart','id': id, 'qty': qty, 'variations': vars}, function(r) {
			reloadCart(r);
            fbq('track', 'AddToCart', {
                contents: [{"currency": "USD", 'id': id, 'quantity': qty, 'item_price': $('p.total').attr('x-numeric')}],
                content_ids: [id],
                content_type: 'product',
                value: parseFloat(r.cart_value),
                currency: "USD"
            });

            gtag('event','add_to_cart', {'value': $('p.total').attr('x-numeric'), 'items': [ { "id": id, "price": $('p.total').attr('x-numeric'), "name": $('.category-header.text-left').text(), "category": $('#cat_path').text(), "google_business_vertical": "retail" } ] });

            ga('ec:addProduct', {
				'id': id,
				'name': $('.category-header.text-left').text(),
				'category': $('#cat_path').text(),
				'price': $('p.total').attr('x-numeric'),
				'quantity': qty
			});
			ga('ec:setAction', 'add');
			ga('send', 'event', 'UX', 'click', 'add to cart');
		},"json");
		// $('form.addToCart').effect("transfer", { to: $('div#global_cart') }, 500);

		return false;
	});

	$('a.paypal').click(function (e) {
		e.stopPropagation();

		if ($('#custom').val() == '---') {
			alert('Something wrong with the checkout process, please refresh the page to checkout again.\n\nIf the issue keep occuring, please contact our customer service.\n\nThank you!');
		} else {
			try {
				paymentSelected('paypal');
				purchaseAction();
			} catch(err) {
			}
			$('form#paypal').submit();
		}

	});
	$('a.coinbase').click(function (e) {
		e.stopPropagation();
		e.preventDefault();

		try {
			paymentSelected('coinbase');
			purchaseAction();
		} catch(err) {
		}

		//I think will help with popups
		newWindow = window.open("", "_blank");
		$.post(CMS_AJAX_URL, {'action':'new-coinbase','a': 'payments','order_id': order_id}, function(r) {
			newWindow.location = r.returned;
		}, 'json');
		return false;
	});
 
	$('a.confirmorder').click(function (e) {
		$('a.payment').hide();
//console.log("check 1a");

		$('#discountcode').val($('#discount').val());
		confirmOrder(); // ga.js code
//console.log("check 1b");

		var jqxhr =	$.post(CMS_AJAX_URL, {'action':'checkout','a': 'cart','data': $('form#order_data').serializeArray() }, function(r) {
//console.log("check 2");
			var cartfb = [];
			var cartgs = [];
			var cartids = [];

            cartproducts.forEach(function(value) {
            	//console.log(value);
            	cartfb.push({"id": value.id, "quantity": value.qty, "item_price": value.base_price});
				cartgs.push({"id":value.id, "name": value.title, "quantity": value.qty, "category": value.cat_path, "price": Number(value.base_price), 'google_business_vertical': 'retail'});
				cartids.push(value.id);
            });

			r = r.cart;
            fbq('track', 'Purchase', {
                contents: cartfb,
                content_ids: cartids,
                content_type: 'product',
                value: (r.amount + r.tax + parseFloat(r.shipping)),
                currency: 'USD'
            });

            gtag('event','purchase', {
            	'value': (r.amount + r.tax + parseFloat(r.shipping)),
				'items': cartgs
            });
//console.log("check 3");

//console.log("order: "+r.order_id);
//console.log("shipping: "+r.shipping);

			order_id = r.order_id;
			$('#amount').val(r.amount + r.tax);
			//alert(r.amount);
			r.shipping = Math.round(r.shipping * 100 / _CONVERSION[$('#currency_code').val()]) / 100;
			$('input[name="shipping"]').val(r.shipping);
			$('.subtotalhook span').text("Shipping: "+r.shipping_name);
			$('.autoload-shipping').text("US$ "+r.shipping);
			//$('a.payment').show();
			$('.accordion > div.element').addClass("disabled");
			if(r.discount !== ""){
				$('a.paypal.payment').replaceWith('<a class="autosize button payment-button hoverable icon-more" href="/shipped-yet/o:'+r.custom+'">&emsp;Proceed&emsp;</a>');

			}
			$('#custom').val(r.custom);
		},"json");

		jqxhr.done(function() {
			if ($('#custom').val() != '---') {
				setTimeout(function() {$('a.payment').show();},10);
			} else {
				alert('Please settle your payment by clicking the link on the email. Thank you!');
			}
		});

	});

	var us_state_selector = $('<select name="state" id="state" style="width: 150px">'
				+'<option value="">-- Please select --</option><option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="DC">District Of Columbia</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="PR">Puerto Rico</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option><option value="AA">Armed Forces Americas</option><option value="AE">Armed Forces Europe</option><option value="AP">Armed Forces Pacific</option>'
			+'</select>');
	var ca_state_selector = $('<select name="state" id="state" style="width: 150px">'
				+'<option value="">-- Please select --</option><option value="AB">Alberta</option><option value="BC">British Columbia</option><option value="MB">Manitoba</option><option value="NB">New Brunswick</option><option value="NL">Newfoundland and Labrador</option><option value="NS">Nova Scotia</option><option value="ON">Ontario</option><option value="PE">Prince Edward Island</option><option value="QC">Quebec</option><option value="SK">Saskatchewan</option><option value="NT">Northwest Territories</option><option value="NU">Nunavut</option><option value="YT">Yukon</option>'
			+'</select>');

	$(document).on("change", '#country',
		function() {
			tmp_val = $('#state').val();
			if ($(this).val() == "US") {
				$('#state_span').empty().append(us_state_selector);
				$('#state').val(tmp_val);
				if ($('#state').prop("selectedIndex") == -1)
					$('#state').val('');
			} else if ($(this).val() == "CA") {
				$('#state_span').empty().append(ca_state_selector);
				$('#state').val(tmp_val);
				if ($('#state').prop("selectedIndex") == -1)
					$('#state').val('');
			} else {
				$('#state_span').empty().append($('<input type="text" name="state" id="state" value="'+tmp_val+'" size="19" class="autosize">'));
			}
	});

	$('#country').change();

	$(document).on('click', '.shipping_options input', function() {
		updateShipping(this);
	});

	$('a.icon-cart.button').click(function() {

		var qty = $('input.qty', $(this).parents('form:first')); var alert_qty = parseInt(qty.attr('x-max-alert')); var stock_qty = parseInt(qty.val());

		if (
			// out of stock items don't get an alert
			alert_qty <= 0

			// large quantity orders don't get an alert either to avoid stock disclosure
			|| stock_qty >= 25

			// no alert if items are in stock
			|| alert_qty >= stock_qty

			// no alert if no qty found
			|| isNaN(alert_qty)
		) {
			$(this).parents('form:first').submit();
		} else {
			if (confirm("Not enough stock for your order. Current stock is "+alert_qty+". Continue anyway?")) {
				$(this).parents('form:first').submit();
			} else {
				qty.focus();
			}
		}
		//show mini-cart
        showPanel('collapseCart');
	});

	$('span.add-to-cart input').click(function(e) {
		e.stopPropagation();
	});

	$('ul.listing a').click(function (e) {
		e.stopPropagation();

		var id = $(this).attr('x-ga-id');
		var pos = $(this).attr('x-ga-pos');
		var href = $(this).attr('href');

		gtag('event','select_item', 
			{
				'items': [{
			       'id': id,
			       'position': pos
			     }]
			}
		);
		window.location.href = href;
	});

	$('a.add-to-cart').click(function() {
		var id = $(this).parents('li:first').attr('x-cms-id');
		var qty = $(this).attr('x-qty');
		if (!qty) qty = 1;

		$.post(CMS_AJAX_URL, {'action':'add','a': 'cart','id': id, 'qty': qty, 'variations': []}, function(r) {reloadCart(r);},"json");
		// $(this).effect("transfer", { to: $('div#global_cart') }, 500);
		return false;
	});

	$(document).on("click", 'a.cart-del-icon', function(e){
		e.stopPropagation();

		//var $this = $('img',$(this));
        var $this = $('i',$(this));
        $.post(CMS_AJAX_URL, {'action':'remove','a': 'cart','id': $this.attr('x-count')}, function(r) {
            /*
            $this.parents("tr:first").fadeOut(300,function() {
                $(this).remove();reloadCart(r);
            });
            */
            // for new mini-cart
            $this.closest("div.row").fadeOut(300,function() {
                $(this).remove();reloadCart(r);
            });
        },"json");

		return false;
	});

	function reloadCart(r) {
            $('div#global_cart').replaceWith(r.html);
            //$('div#mini_cart').click();
            var items = Math.max(0,$('div#global_cart div.row').length - 2);
            /*
            var items = Math.max(0,$('div#global_cart tr').length - 2);
            var q = $('div#global_cart tr.total td:gt(0) b') , total = "0.00";
            if (q.length > 0) {
                    total = q.text().substring(4);
            }
            */
            // for new mini-cart
            var q = $('div#global_cart div.row div.text-right.col b:gt(0)') , total = "0.00";
            if (q.length > 0) {
                    total = q.text().substring(4);
            }
            $('div#mini_cart').empty().append(items+" items<br />USD "+total);

            if (items <= 0) {
            	$('div#cart_qty').removeClass('cart_qty');
            } else {
            	$('#cart_qty').attr('data-count',items);
            	$('div#cart_qty').addClass('cart_qty');
            }
            //window.location.href = window.location.href.substring(0,window.location.href.indexOf("#mini_cart")+0) + "#mini_cart";
    }


	$('textarea.messaging').focus(function() { if (!$(this).hasClass("cleared")) {$(this).data("value",$(this).val()); $(this).val('');$(this).addClass("cleared");}});

	$('a.submit-message').click(function() {
		$.post(CMS_AJAX_URL, {'action':'new-message','a': 'cart','oid': $('#oid').val(), 'msg': $('textarea.messaging').val(), 'notify': $('input.notify').is(":checked")}, function(r) {
			$('ul.date-list li').removeClass("first");
			var html = $(r.html);
			html.addClass("first").hide();
			$('ul.date-list').append(html);
			$('textarea.messaging').removeClass("cleared").val($('textarea.messaging').data("value"));
			html.slideDown();
		},"json");
		return false;
	});

	$('li.product-item > span > .refund-button').click(function() {
		if (confirm("Are you sure you want to cancel this product and refund the money?")) {
			$.post(CMS_AJAX_URL, {'action':'refund','a': 'cart','id': $(this).parents("li.product-item:first").attr('x-id'),'confirm': txn_id}, function(r) {
				window.location.href = "https://www.team-blacksheep.com/shipped-yet/o:"+txn_id + "?x="+Math.random();
			},"json");
		}
	});

	$('li.product-item > span > .refund-item-button').click(function() {
		if (confirm("Are you sure you want to cancel this product customization and refund the money?")) {
			$.post(CMS_AJAX_URL, {'action':'refund-variation','a': 'cart','id': $(this).attr('x-id'),'confirm': txn_id}, function(r) {
				window.location.href = "https://www.team-blacksheep.com/shipped-yet/o:"+txn_id + "?x="+Math.random();
			},"json");
		}
	});

	$('.payment-button.delopenorder').click(function() {
		if (confirm("Are you sure you want to cancel the order?")) {
			$.post(CMS_AJAX_URL, {'action':'delete-order','a': 'cart','id': $('#oid').val(),'confirm': txn_id}, function(r) {
				window.location.href = "https://www.team-blacksheep.com/shipped-yet/o:"+txn_id + "?x="+Math.random();
			},"json");
		}
	});

	$('.cancel-whole-order').click(function() {
		if (confirm("Are you sure you want to cancel the entire order and refund the money?")) {
			$.post(CMS_AJAX_URL, {'action':'refund-order','a': 'cart','id': $('#oid').val(),'confirm': txn_id}, function(r) {
				window.location.href = "https://www.team-blacksheep.com/shipped-yet/o:"+txn_id + "?x="+Math.random();
			},"json");
		}
	});
	$('.upgrade-ups').click(function() {
		if (confirm("Confirm upgrade to UPS Shipping")) {
			$.post(CMS_AJAX_URL, {'action':'ups-upgrade','a': 'cart','id': $('#oid').val(),'confirm': txn_id}, function(r) {
				window.location.href = "https://www.team-blacksheep.com/shipped-yet/o:"+txn_id + "?x="+Math.random();
			},"json");
		}
	});

	$('.cancel-items').click(function() {
		if ($(this).data("toggle") == true) {
			$(this).data("toggle",false);
			$('.refund-item-button , .refund-button').hide();
		} else {
			$(this).data("toggle",true);
			$('.refund-item-button , .refund-button').show();
		}
	});

	$('.declaration').click(function() {
		if (!$('#self-declaration').data("visible")) {
			$('#self-declaration').data("visible",true);
			$('#self-declaration').slideDown();
		} else {
			$('#self-declaration').data("visible",false);
			$('#self-declaration').slideUp();
		}
	});
	$('.declaration').data("visible",false);

	$('#save-declared-value').click(function() {
		$('#self-declaration').slideUp();
		$('#self-declaration').data("visible",false);
		$.post(CMS_AJAX_URL, {'action':'update-declaration','a': 'cart','id': $('#oid').val(),'confirm': txn_id,'declared_value': Math.round($('#declared_value').val()*100)/100,'cn22_description': $('#cn22_description').val()}, function(r) {
			window.location.href = window.location.href + "?x="+Math.random();
		});
	});
	$('.recalculate-shipping').on("click", function(){
		$('.recalculating').attr('src','/img/loading.gif');
		$.post(CMS_AJAX_URL, {'action':'recalculate-shipping','a': 'cart','id': $('#oid').val(),'confirm': txn_id}, function(r) {
			$('.recalculation').remove();
			$('.recalculate-shipping').after(r.html);
			$('.recalculating').attr('src','/img/icons/arrow_refresh.png');

			$('.exec-update-shipping').on("click", function(){
				$('.exec-update-shipping').append("<img class=\"submitting\" src=\"/img/loading.gif\">");
				$shipping = $('li input[name="shipping_provider"]:checked');

				var shipping_type = $shipping.val();
				var new_shipping = Math.round(($shipping.parents().attr('x-ship-price') * 1)*100)/100;
				var old_shipping = Math.round((($('.autoload-shipping').text().substr(3)) * 1)*100)/100;

				if(confirm( "The customer will owe TBS: US$ " + number_format((Math.round((new_shipping - old_shipping) * 100) /100) , 2) + "\nOK?")){
					var shipping_type = $('li input[name="shipping_provider"]:checked').val();
					$.post(CMS_AJAX_URL, {'action':'submit-shipping','a': 'cart','id': $('#oid').val(),'confirm': txn_id, 'type': shipping_type, "new": new_shipping}, function() {
						$('.exec-update-shipping').append("ted<img src=\"/img/icons/emoticon_happy.png\">");
					}, "json");
					setTimeout(function(){window.location.reload();}, 500);
				}
				$('.submitting').remove();
			});

		}, "json");

	});


	$('.empty-cart').click(function() {
		$.post(CMS_AJAX_URL, {'action':'empty-cart','a': 'cart','id': $('#oid').val(),'confirm': txn_id}, function(r) {

			setTimeout(function(){ reloadCart(r); }, 0);

		},"json");
	});

	$('.copy-cart').click(function() {
		$.post(CMS_AJAX_URL, {'action':'copy-cart','a': 'cart','id': $('#oid').val(),'confirm': txn_id}, function(r) {

			setTimeout(function(){ reloadCart(r); }, 0);

		},"json");
	});

	$('.show-split-order').click(function() {
		if ($(this).data("toggle") == true) {
			$(this).data("toggle",false);
			$('#btn_checkbox_select_all, #admin-split-var-checkbox , #admin-split-checkbox , .admin-split-exec, #admin-split-order-shipping, #admin-split-order-shipping-label').hide();
		} else {
			$(this).data("toggle",true);
			$('#btn_checkbox_select_all, #admin-split-var-checkbox , #admin-split-checkbox , .admin-split-exec, #admin-split-order-shipping, #admin-split-order-shipping-label').show();
		}
	});
	$('.merge-order').click(function() {
		var children = prompt("Please make sure merge orders on the same order status!\n\nPlease enter the orders to merge (separated by commas and no spaces). Also, remember that the status of the parent order will not change. It is up to you to collect the right payment!", "");
		var parent = $('#oid').val();

		if (children == null || children == "") {
			return false;
		} else {
			if (confirm("Merge " + children + " into " + parent + "?")) {
				$.post(CMS_AJAX_URL, {'a': 'adminorders','action':'merge-orders','parent':parent,'children':children}, function(r) {
					if (r.success) {
						alert("completed: " + r.completed);
						window.location.reload();
					} else {
						alert('failed');
					}
				} ,"json");
			} else {
				return false;
			}
		}
	});
	$('#btn_checkbox_select_all').click(function() {
		if (this.value == "select") {
			$(".shopping-cart-entry").find(':checkbox').prop("checked",true);
			this.value = "unselect";
		} else {
			$(".shopping-cart-entry").find(':checkbox').prop("checked",false);
			this.value = "select";
		}
	});
	$('.admin-split-exec').click(function() {
		$('#pause').show();
		var items = new Array();
		var variations = new Array();
		$('input:checkbox[name=split-checkbox]:checked').each(function() {
			//Select all the orders_products.id of the checked products...
			items.push($(this).parents("li.product-item:first").attr('x-id'));
		});
		$('input:checkbox[name=split-var-checkbox]:checked').each(function() {
			//Select all the orders_productsvariation.id of the checked variations...
			variations.push($(this).attr('x-id'));
		});

		var change_shipping = $('input#admin-split-order-shipping').is(':checked');
		//make the arrays pretty
		var items_to_split = items;
		var variations_to_split = variations;
		//Send the Post
		if (confirm("Are you sure you want to move these products to a new order:\nProducts:"+JSON.stringify(items,null, 1)+"\nVariations:"+JSON.stringify(variations,null, 1))) {
			$.post(CMS_AJAX_URL, {'action':'split-order','a': 'cart','products':items_to_split,'variations':variations_to_split,'id': $('#oid').val(),'confirm': txn_id, 'change_shipping': change_shipping}, function(r) {showNewOrders(r);} ,"json");
		}
	});
	$(document).on("change", "input:checkbox[name=split-checkbox]", function () {
		$(this).css('hover', 'not-allowed');
	    if ($(this).prop('checked')) {
	    	$subitem = $(this).parent().parent().children('span.subitem');
	    	$subitem.children('input:checkbox').prop('checked', true);
	    	$subitem.children('input:checkbox').css('cursor', 'not-allowed');
	    }
	    else {
	    	$subitem = $(this).parent().parent().children('span.subitem');
	    	$subitem.children('input:checkbox').prop('checked', false);
	    	$subitem.children('input:checkbox').css('cursor', 'auto');
	    }
	});
	function showNewOrders(r) {
		$('#pause').hide();
		//Upon a successful Post, alert the user of the two new orders
		alert("The selected products have been moved into a new order.\n\n" + "New Order ID:" + r.neworder.details["order_id"] + "\n  Shipping:" + r.neworder["shipping"] + "\n Additional Shipping Cost:" + r.additional_shipping + "\nPlease check your email.");
		window.location.href = window.location.href;
		//window.location.href = window.location.href + "?x="+Math.random();
	}

	$('.show-edit-address').click(function(){
		if ($(this).data("toggle") == true) {
			$(this).data("toggle",false);
			$('#edit-address, .exec-edit-address').hide();
			$('.address').show();
		} else {
			$(this).data("toggle",true);
			$('#edit-address, .exec-edit-address').show();
			$('.address').hide();
		}
	});

	$('.exec-edit-address').click(function(){
		//Pull each address value from the inputs with the edit-address class
		var data = new Array();
		data = $.map($("#edit-address [id]"), function(n, i) {
				return n.value;
			});
		//send the post
		if (confirm("PLEASE check the address to make sure there are NO typos:\n" + JSON.stringify(data,null, 1))) {
			$.post(CMS_AJAX_URL, {'action':'edit-address','a': 'cart','data':data,'id': $('#oid').val(),'confirm': txn_id}, function(r) {showNewShipping(r)} ,"json");
		}
	});

	function showNewShipping(r) {
		//Show the new shipping price and alert the user if TBS must refund the customer or if they owe us money
		var difference = Math.round(100*(r["newshipping"] - r["oldshipping"]))/100;
		var reply = "\nThe customer must pay an additional: ";
		if(difference < 0){
			Math.abs(difference);
			reply = "\nTBS must refund the customer: ";
			difference = -difference;
		}
		alert("The shipping cost is now:" + r["newshipping"] + reply + difference + "\nThis order's address has been updated to:\n " + JSON.stringify(r["address"], null, 1));
		window.location.reload();
	}

	$(document).on("click", '#local_convert', function() {
		updateLocalPayment();
	});

	$('#checkout_register_form').on("submit", function(e) {
		// stop this event
		e.stopPropagation();
		e.preventDefault();
		return false;
	});
	$('#checkout_login_form').on("submit", function(e) {
		e.stopPropagation();
		e.preventDefault();
		var $this = $(this);
		$.post(CMS_AJAX_URL, {'action':'loginUser','a': 'login','user': $('#login_email').val(),'uauth': 'email', 'pass': $('#login_password').val()}, function(r) {
			if (r.success == "false") {
				// flash the login form to indicate failed login
				$('#checkout_login_form').fadeOut(200,function() { $(this).fadeIn(200) } );
			} else {
				// hide the login form (we are now logged in)
				$this.hide();
				$('a.button.next',$this.parent().parent()).show();

				// hide the registration form (we are logged in)
				$('#checkout_register_form').hide();
				$('.user-unique',$('#checkout_register_form')).removeClass("user-unique");
				$('.pw-validate',$('#checkout_register_form')).removeClass("pw-validate");
				$('h2.create_account').hide();

				// populate login data
				preloadShoppingCart(r);

				// proceed to next accordion-tab
				$('a.next.skip-login').click();
			}
		},"json");
		return false;
	});
	$('.register-account').click(function() {
		$('#email').val($('#register_email').val());
		$('#cart_pass').val($('#register_password').val());
		$('#tmp_customer_type').attr('value','retail');
	});
	$("#register_email").on('blur',function() {
		$(".user-unique").attr('x-uid-unique',"0");
		$("b",$(".user-unique").parent()).remove();

		$.post(CMS_AJAX_URL, {'action':'checkUsername','a': 'login','user': $('#register_email').val()}, function(r) {
			$(".reset-pw-callout").remove();
			if (r.success == false || r.success == "false") {
				$(".user-unique").addClass("red");
				$(".user-unique").attr('x-uid-unique',"0");
				$(".user-unique").after("<span class=\"red reset-pw-callout\"><br />Existing users please <a href=\"#\" onclick=\"showPanel('collapseForgotPassword');\">reset password</a></span>");
			} else {
				$(".user-unique").removeClass("red");
				$(".user-unique").attr('x-uid-unique',"1");
			}
		},"json");
	});

	$("input.btn.shipping_details").click(function(e) {
		e.stopPropagation();
		var id, shipping_method, shipping_cost , $this = $(this);

		id = $('#oid').val();
		shipping_method = $('#shipping_method').val();
		shipping_cost = $('#shipping_cost').val();
		
//console.log('id: '+id+' shipping_method: '+shipping_method+' shipping_cost: '+shipping_cost);
		if (confirm('Are you sure you want to update Retail value?')){
			$.post(CMS_AJAX_URL, {'action':'updateShippingDetails','a': 'adminorders','id': id, 'shipping_method': shipping_method, 'shipping_cost': shipping_cost}, function(r) { 
				if (r.success) { location.reload(); }
				else {
					alert('Error! Wrong input!');
				}
			},"json");

		}
	});

	$("span.btn.tracking").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();
		trackingNo = prompt("Please enter Tracking ID");

		$.post(CMS_AJAX_URL, {'action':'markshipped','a': 'adminorders','id': id, 'tracking': trackingNo, 'email': 0}, function(r) { if (r.success) { location.reload(); }},"json");

	});

	$("span.btn.shipped").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();
		trackingNo = prompt("Please enter Tracking ID");

		$.post(CMS_AJAX_URL, {'action':'markshipped','a': 'adminorders','id': id, 'tracking': trackingNo}, function(r) { if (r.success) { location.reload(); }},"json");

	});
	$("span.btn.cshold").on('click', function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);
		id = $('#oid').val();

		$.post(CMS_AJAX_URL, {'action':'updatestatus','a': 'adminorders','id': id, 'status': 'cshold'}, function(r) { if (r.success) { location.reload(); }},"json");

	});
	$("span.btn.reminder_license").on('click', function(e) {
		e.stopPropagation();
		var id;
		id = $('#oid').val();

		$.post(CMS_AJAX_URL, {'action':'reminder_license','a': 'adminorders','id': id}, function(r) { if (r.success) { location.reload(); }},"json");

	});



	$("span.btn.paid").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();

		var $info_para = $(this).parent();
		$.post(CMS_AJAX_URL, {'action':'guesspayments','a': 'payments','id': id}, function(r) {
			if($('.active').length > 0) {
				$('.active').slideUp();
				$('.active').remove();
			}
			var new_text = "<div class=\"table_payments\"><h3>Similar Payments</h3><br />";
			new_text +="<form id=\"search_payments\"><input type=\"text\" id=\"search_text\" onClick=\"this.select();\" placeholder=\"search\"/><input type=\"submit\"/ value=\"Find\"></form>";
			if (r.payments.length == 0) {
				new_text += ("<h2 align=\"center\">No payments found :(<h2>");
			} else {
				var table = "<table class=\"table_payments\"><tr><th>Name</th><th>Email</th><th>User</th><th>Order</th><th>Total</th><th>Currency</th><th>Transaction</th><th>Date</th></tr>";
				for (key in r.payments) {
					table += ("<tr class=\"payment\" id=\""+r.payments[key].id+"\"><td>"+r.payments[key].name+"</td><td>"+r.payments[key].from_email+"</td><td>"+r.payments[key].user_id+"</td><td>"+r.payments[key].order_id+"</td><td>"+r.payments[key].gross+"</td><td>"+r.payments[key].currency+"</td><td>"+r.payments[key].transaction_id+"</td><td>"+r.payments[key].payment_datetime+"</td></tr>");
				}
				table +=("</table>");
				new_text += (table);
			}
			if (r.order.paypal_id != '') {
				new_text += ("<a align=\"left\" id=\"no_payment\" class=\"autosize hoverable button no_payment icon-more\" href=\"javascript:void(0);\">MARK AS PAID WITHOUT PAYMENT</a>");
			}

			new_text += ("<a align=\"left\" id=\"classify_payment\" class=\"autosize hoverable button classify_payment icon-more\" href=\"javascript:void(0);\">Classified Payment</a><a id=\"submit\" class=\"autosize hoverable button submit-payment icon-more\" href=\"javascript:void(0);\">CONNECT PAYMENT(S) FROM LIST</a><br /><br /><br />");
			new_text += ("</div>");
			var slideDown = $(new_text);

			slideDown.remove();
			slideDown.addClass("active");
			$info_para.after(slideDown);
			slideDown.slideDown();

			$('.table_payments a#no_payment').click(function(e) {
				$.post(CMS_AJAX_URL, {a: "adminorders", action: "updatestatus", 'id': id, 'status':'paid'}, function(r) {console.info(r); if (r.success) { location.reload(); }},"json");
			});
			$('.table_payments a#classify_payment').click(function(e) {
				$.post(CMS_AJAX_URL, {a: "payments", action: "pullaccounts", 'type': 'internal'}, function(re) {
					var new_payment = "<div class=\"new_payment\"><h3>New Payment</h3>";
					new_payment += "<form id=\"payment_form\">";
					new_payment += "<select id=\"payment_class\">";
						new_payment += "<option id=\"credit\" value=\"17\">Credit Payment</option>";
						new_payment += "<option id=\"credit\" value=\"95\">Sponsorship</option>";
						new_payment += "<option id=\"credit\" value=\"99\">Warranty</option>";
					new_payment += "</select>";

					/*for (key in re.types) {
						new_payment += "<option value=\""+re.types[key].id+"\" currency=\""+re.types[key].currency+"\">"+re.types[key].label+"</option>";
					}*/

					new_payment += "<input type=\"submit\" action=\"\" value=\"Create Payment\">";
					var new_payment = $(new_payment);
					slideDown.after(new_payment);

					$('.new_payment form#payment_form').submit(function(e) {
						var class_type = $('.new_payment form#payment_form select').val()
						var created = 'false';
						switch(class_type) {
							case '17':
								//tab orders
								if (confirm("THIS IS FOR APPROVED RETAILERS ONLY")) {
									if (confirm("IN CASE YOU HIT THAT ACCIDENTALLY, YOU ARE RESPONSIBLE FOR YOUR ACTIONS, DUDE!")) {
										$.post(CMS_AJAX_URL, {a: "payments", action: "formulatepayment",'order_id': id, 'user_id': r.order.user_id, 'type':17}, function(r) {
											if (r.success) {
												var created = 'true';
											}
										},'json');
									}
								} else {
									return false;
								}
								break;
							case '95':
								//insert sponsorship here
								if (confirm("Are you sure that you want to mark this as paid as a sponsorship")) {
									$.post(CMS_AJAX_URL, {a: "payments", action: "formulatepayment",'order_id': id, 'user_id': r.order.user_id, 'type':95}, function(r) {
										if (r.success) {
											var created = 'true';
										} else {
											alert(r.message);
										}
									}, 'json');
								} else {
									return false;
								}
								break;
							case '99':
								//insert warranty here
								if (confirm("Are you sure that you want to mark this as paid as a warranty replacement")) {
									$.post(CMS_AJAX_URL, {a: "payments", action: "formulatepayment", 'order_id': id, 'user_id': r.order.user_id, 'type':99}, function(r) {
										if (r.success) {
											var created = 'true';
										} else {
											alert(r.message);
										}
									}, 'json');
								} else {
									return false;
								}
								break;
							default:
								console.info('shouldnt happen');
								created = false;
						}
						if (created) {
							$.post(CMS_AJAX_URL, {a: "adminorders", action: "updatestatus", 'id': id, 'status':'paid', 'class_type':class_type}, function(r) {console.info(r); if (r.success) { location.reload(); }},"json");
						} else {
							alert('failed');
						}

						e.stopPropagation();
						e.preventDefault();
					});
					/*$('.new_payment form#payment_form').submit(function(e) {
						e.stopPropagation();
						e.preventDefault();

						var payment = {};
						payment.account_internal = $('form#payment_form select#payment_type').val();
						payment.account_name = '46';
						payment.status = 'Completed';
						//no curency accounts__account payment.currency = $('form#payment_form select#payment_type option:selected').attr('currency')
						payment.gross = parseFloat($('form#payment_form #gross').val());
						payment.fee = parseFloat($('form#payment_form #fee').val());
						payment.net = (payment.gross - payment.fee)
						payment.from_email = r.order.email;
						payment.transaction_id = $('form#payment_form #transaction_id').val();
						payment.custom_number = r.order.txn_id;
						payment.address = r.order.address1 + " " + r.order.address2 + " " + r.order.city + " " + r.order.state + " " + r.order.zip + " " + r.order.country;
						payment.user_id = r.order.user_id;
						payment.name = r.order.name;
						payment.order_id = r.order.id;
						payment.department = 'sales';
						payment.type = 'Manual Payment Received';
						payment.payment_datetime = $('form#payment_form #payment_date').val();
						$.post(CMS_AJAX_URL, {a: "payments", action: "createpayment", 'info': payment}, function(r) {
							alert(r);
							if (r.success) {
								$.post(CMS_AJAX_URL, {a: "adminorders", action: "updatestatus", 'id': payment.order_id, 'status':'paid'}, function(r) {console.info(r); if (r.success) { location.reload(); }},"json");
							} else {
								alert('failed');
							}
						}, 'json');
					});*/
				}, 'json');
			});
			$('.table_payments a#submit').click(function(e) {
				var payments = $('.active tr.payment.selected');
				console.info(payments);
				for (var i=0; i<payments.length; i++) {
					var payment_id = payments[i].id
					$.post(CMS_AJAX_URL, {a: "payments", action: "linkorderpayment", 'payment_id': payment_id, 'order_id': id}, function(r) {
						if (r.success) {
							alert('success, case:'+r.case);
							$.post(CMS_AJAX_URL, {'action':'updatestatus','a': 'adminorders','id': id,'status':'paid'}, function(r) { console.info(r); if (r.success) { location.reload(); }},"json");
						} else {
							alert('failed');
						}
					},'json');
				}
			});
		},"json");
	});

	$(document).on('submit','.active form#search_payments',function(e) {
		e.stopPropagation();
		e.preventDefault();
		var term = $('.active form#search_payments input#search_text').val();
		$.post(CMS_AJAX_URL, {'action':'searchpayments','a': 'payments','term': term}, function(r) {

			$('.active table.table_payments tr.payment').remove();
			for (key in r.payments) {
				$('.active table.table_payments tbody tr:not(.payment)').after("<tr class=\"payment\" id=\""+r.payments[key].id+"\"><td>"+r.payments[key].name+"</td><td>"+r.payments[key].from_email+"</td><td>"+r.payments[key].user_id+"</td><td>"+r.payments[key].order_id+"</td><td>"+r.payments[key].gross+"</td><td>"+r.payments[key].currency+"</td><td>"+r.payments[key].transaction_id+"</td><td>"+r.payments[key].payment_datetime+"</td></tr>");
			}

		},'json');
	});

	$(document).on('click','.active tr.payment',function(e) {
		if ($(this)[0].classList.contains("selected")) {
			$(this).removeClass("selected");
		} else {
			$(this).addClass("selected");
		}
	})
	$(document).on('hover','.active tr.payment',function(e) {
		alert('hover');
		$(this).addClass("highlight");
	}, function() {
		$(this).removeClass("highlight");
	});
	$("span.btn.resume").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();
		$.post(CMS_AJAX_URL, {'action':'updatestatus','a': 'adminorders','id': id,'status':'resume'}, function(r) { if (r.success) { location.reload(); }},"json");
	});


	$("span.btn.packing").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();

	});

	$("span.btn.packed").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();

		$.post(CMS_AJAX_URL, {'action':'updatestatus','a': 'adminorders','id': id,'status':'packed'}, function(r) { if (r.success) { location.reload(); } },"json");
	});

	$("span.btn.delete").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();

		if (confirm("are you sure?")) {
			$.post(CMS_AJAX_URL, {'action':'updatestatus','a': 'adminorders','id': id, 'status': 'deleted'}, function(r) { if (r.success) { location.reload(); }  },"json");
		}
	});

	$("span.btn.reopen").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();

		$.post(CMS_AJAX_URL, {'action':'updatestatus','a': 'adminorders','id': id, 'status': 'open'}, function(r) { if (r.success) { location.reload(); } },"json");
	});

	$("span.btn.paymentmail").click(function(e) {
		e.stopPropagation();
		var id , trackingNo , $this = $(this);

		id = $('#oid').val();

		$.post(CMS_AJAX_URL, {'action':'updatestatus','a': 'adminorders','id': id, 'status': 'email-sent'}, function(r) { if (r.success) { location.reload(); } },"json");
	});


    $('.write-address, button.applydiscount').click(function()
    {
//console.log($('button.applydiscount').is(this));

		if ($('button.applydiscount').is(this)) {
			$('#discount_error').text('');
			// if not valid, remove the code and show error message
	        $.post(CMS_AJAX_URL, {'action':'checkdiscount','a': 'cart', 'code': $('#discount').val(), 'total': (Math.round(($('li.total').attr('x-total') * 1)*100)/100) }, function(r) {
	            if(r.length > 0)
	            {
	            	if (r.substring(0, 5) == 'Error') {
						$('#discount').val('');
						$('#discount_error').attr('style','color:red; font-weight: 500;');
					} else {
						$('#discount_error').attr('style','color:blue; font-weight: 500;');
					}
					$('#discount_error').text(r);
	            }
	        },"json");

			// apply the product discounted price if code valid
		} else {
			var currencies = {
				"EUR": ['AT','BE','CY','EE','FI','FR','DE','GR','IE','IT','LV','LU','MT','NL','PT','SI','SL','ES'],
				"USD": ['US'],
				"CHF": ['CH']
			};
			var currency = "USD";

			for (c in currencies) {
				if (currencies[c].constructor.toString().indexOf("Array")) {
					for (var x=0;x<currencies[c].length;x++) {
						if ($('#country').val() == currencies[c][x]) {
							currency = c;
						}
					}
				}
			}

			if (currency == "EUR" || currency == "CHF") {
				$('p.local_convert_section em').text(" "+currency);
				if (!$('#local_convert').is(':checked')) {
					$('#local_convert').trigger( "click" );
				}
			} else {
				if ($('#local_convert').is(':checked')) {
					$('#local_convert').trigger( "click" );
				}
			}

		}

        $('.confirmorder').hide();
        $('p.address').html($('#name').val()+"<br />"+$('#address1').val()+"<br />"+$('#zip').val()+" "+$('#city').val()+"<br />"+$('#state').val()+"<br />"+$('#country')[0].options[$('#country')[0].selectedIndex].text+"<br />&nbsp;<br />tel: "+$('#tel').val()+"<br />E-Mail: <a href='mailto:"+$('#email').val()+"'>"+$('#email').val()+"</a>");
        $('li.shipping_options').remove();
        $('ul.shopping-cart-entry:first .total').before('<li class="shipping_options" style="background: transparent url(\'/img/loading.gif\') no-repeat 6px 4px;"><hr class="checkout" style="margin-top: 24px;"><h4>Your Shipping Options</h4></li>');
        $('.shipping_options').css('background', 'transparent url(\'/img/loading.gif\') no-repeat 6px 4px');
        addressProceed(); // ga.js code
        $.post(CMS_AJAX_URL, {'action':'getshipping','a': 'cart', 'discount': $('#discount').val(),'country': $('#country').val(),'zip': $('#zip').val(),'state': $('#state').val(),'city': $('#city').val(),'address1': $('#address1').val()}, function(r)
        {
            $('li.shipping_options').remove();
//console.log('here:'+r.html);
          
			$('ul.shopping-cart-entry:first .subtotal').before(r.html);
            $('.shipping_options').css('background', 'none');
            $('.shipping_options li input:first').attr('checked',true);
            // keep this to prevent no shipping value
            updateShipping($('.shipping_options li input:first')[0]);
            // run below to get the selected shipment cost
            updateShipping($('input[type=radio][name=shipping_provider]:checked'));

            //if(r.success) {
//console.log('here:'+r.html.indexOf( "No shipping option found." ));
            	if( r.html.indexOf( "No shipping option found." ) >= 0 )
            		$('.confirmorder').hide();
            	else
                	$('.confirmorder').show();
            //}
        },"json");
    });



});

function preloadShoppingCart(r) {
	$('#name').val(r.FirstName+" "+r.LastName);
	$('#email').val(r.email);
	$('#tel').val(r.Phone);
	$('#address1').val(r.AddressStreet1);
	$('#city').val(r.AddressCity);
	$('#zip').val(r.AddressZIP);
	$('#country').val(r.AddressCountry).change();
	$('#state').val(r.AddressState);

	// set user_id
	$('#user_id').val(r.id);

	if ($.isNumeric(r.retail)) {
		if (r.retail > 0)
			$('#tmp_customer_type').attr('value','wholesale');
		else
			$('#tmp_customer_type').attr('value','retail');
	}
}

function updateLocalPayment() {
	var total = $('#local_convert').attr("x-amount");
	var shipping = $('#local_convert').attr("x-shipping");
	var currencies = {
		"EUR": ['AT','BE','CY','EE','FI','FR','DE','GR','IE','IT','LV','LU','MT','NL','PT','SI','SL','ES'],
		"USD": ['US'],
		"CHF": ['CH']
	};
	var currency = "USD";

	for (c in currencies) {
		if (currencies[c].constructor.toString().indexOf("Array")) {
			for (var x=0;x<currencies[c].length;x++) {
				if ($('#country').val() == currencies[c][x]) {
					currency = c;
				}
			}
		}
	}

	if (currency == "USD") {
		$('.local_currency_layer').hide();
	} else {
		$('.local_currency_layer').show();
	}

	if ($('#local_convert').prop('checked')){
		$('.local_currency_layer').show();
		total = Math.round($('#local_convert').attr("x-amount") * 100 / _CONVERSION[currency]) / 100;
		shipping = Math.round($('#local_convert').attr("x-shipping") * 100 / _CONVERSION[currency]) / 100;
		$('p.local_convert_section').show();
		$('.currency_code').val(currency);

		// if EUR or CHF
		if (currency == "EUR" || currency == "CHF")
			$('#paypal_business').val("38KF3XZLL59BW");
		else
			$('#paypal_business').val("paypal-us@team-blacksheep.com");

		$('p.local_convert_section em').text(Math.round((total+shipping)* 100)/100 +" "+currency);
	} else {
		total = $('#local_convert').attr("x-amount");
		shipping = $('#local_convert').attr("x-shipping");
		$('.currency_code').val("USD");
		$('#paypal_business').val("paypal-us@team-blacksheep.com");
		$('p.local_convert_section').hide();
		$($('.local_currency_layer')[1]).hide();
	}

	$('#amount').val(total);
	$('#shipping').val(shipping);
}

function PayPalSuckADick() {
	$('#pp_address1').val($('#address1').val());
	$('#pp_address2').val($('#address2').val());
	$('#pp_city').val($('#city').val());
	$('#pp_country').val($('#country').val());
	$('#pp_state').val($('#state').val());
	$('#pp_zip').val($('#zip').val());
	$('#pp_first_name').val($('#name').val());
	$('#pp_email').val($('#email').val());
}

function updateShipping(ele) {
		$('.confirmorder').hide();
		$('#shipping_type').val($(ele).val());
		var shipping = Math.round(($(ele).parents('li:first').attr('x-ship-price') * 1)*100)/100;

		var subtotal = Math.round(($('li.total').attr('x-total') * 1)*100)/100;
		var taxrate = 0;
		var tax = 0;
		if ($(ele).parents("li:first").attr('x-ship-tax') == "1"){
			taxrate = $(ele).parents('li:first').attr('x-ship-taxrate') / 100;
			tax = subtotal * taxrate;
		}

		$('input[name="shipping"]').val(shipping);

		if ($(ele).attr('x-contains-shipping-warning') == "1") {
			$('#shippingwarning').show();
		} else {
			$('#shippingwarning').hide();
		}

		$('#amount').val(Math.round((subtotal + tax)*100)/100);
		$('#local_convert').attr("x-amount",Math.round((subtotal + tax)*100)/100,2);
		$('#local_convert').attr("x-shipping",Math.round((shipping)*100)/100,2);

		$('li.subtotalhook em:last').text("US$ " + number_format(Math.round((shipping + subtotal)*100)/100,2));
        $('li.taxamounthook em').text("US$ "+ number_format(Math.round((tax)*100)/100,2));
        $('li.taxratehook em').text((taxrate * 100) + "%");
		$('li.finalhook em:last , li.totalhook em').text("US$ " + number_format(Math.round((shipping + subtotal + tax)*100)/100,2));

		updateLocalPayment();
		PayPalSuckADick();
		$('.confirmorder').show();
}
</script>					</div>
				</div>
			</div>
			</div>
		</div>
	</div>
	<!-- END mini-cart panel -->
</div>
<!-- END All panel place here! -->

<!-- popup alert -->

<!-- END popup alert -->

	<!-- SIDEBAR -->
	<div class="wrapper bg-black d-md-none">
		<div style="overflow-y: auto;">	
            <!-- Sidebar Holder -->
            <div id="sidebar" class="bg-black">
            	<!--
                <div id="dismiss">
                    <i class="far fa-times-circle fa-lg text-white"></i>
                </div>
            -->

                <ul id="menu_scroll" class="list-unstyled components obj-scroll-body-not">
                	<div class="text-center">
                			                				<div class="float-left">
		                			<a data-toggle="collapse" href="#collapseLogin" role="button" aria-expanded="false" aria-controls="collapseLogin" id="login-holder" class="nav-link">
										<span id="slidebar_login" onclick="closeSlidebar();"><i class="far fa-user fa-sm px-2 text-white"></i><br/>Login</span>
									</a>
		                		</div>
													<!--
                		<div class="float-left"><a href="javascript:showLoginScreen();" id="login-holder" class="nav-link"><i class="fas fa-box-open fa-sm px-2 text-white"></i><br/>My Order</a></div>
                		<div class="float-left"><a href="javascript:showLoginScreen();" id="login-holder" class="nav-link"><i class="far fa-heart fa-sm px-2 text-white"></i><br/>Wishlist</a></div>
                		-->
                	</div>
					<hr class="hr-white">            

					<!-- Tree View - START -->
					<div class="pt-3 pl-3">SHOP</div>
					<div class="container">
					    <div class="row">
					        <div class="col-md-4 col-md-offset-4" style="overflow-y: auto;">
					        	<ul id="treeview">
					        		<li style="display: inline-flex;"><i class="fas fa-th-list fa-lg px-2 text-white" style="line-height: 0; display: inline;"></i>CATEGORIES
							            <ul>
							            	<li><a href="/shop">Back in Stock</a></li>
							                <li style="line-height: 0; display: inline;">Ready to Fly<ul><!-- start --><li style="line-height: 0; display: inline;">Race<ul><!-- start --><li><span x-cms-id="505" onclick="self.location='/shop/cat:ready-to-fly-race-micro';">Micro</span></li><li><span x-cms-id="506" onclick="self.location='/shop/cat:ready-to-fly-race-miniquad';">Miniquad</span></li><!-- end --></ul></li><li><span x-cms-id="507" onclick="self.location='/shop/cat:ready-to-fly-freestyle';">FreeStyle</span></li><li><span x-cms-id="508" onclick="self.location='/shop/cat:ready-to-fly-long-range';">Long Range</span></li><li><span x-cms-id="509" onclick="self.location='/shop/cat:ready-to-fly-cinematic';">Cinematic</span></li><li style="line-height: 0; display: inline;">Whoops<ul><!-- start --><li><span x-cms-id="511" onclick="self.location='/shop/cat:ready-to-fly-whoops-brushed';">Brushed</span></li><li><span x-cms-id="512" onclick="self.location='/shop/cat:ready-to-fly-whoops-brushless';">Brushless</span></li><!-- end --></ul></li><!-- end --></ul></li><li><span x-cms-id="337" onclick="self.location='/shop/cat:new';">New Products</span></li><li><span x-cms-id="513" onclick="self.location='/shop/cat:bundles';">Bundles</span></li><li style="line-height: 0; display: inline;">Frames<ul><!-- start --><li><span x-cms-id="515" onclick="self.location='/shop/cat:frames-whoops';">Whoops</span></li><li><span x-cms-id="516" onclick="self.location='/shop/cat:frames-micro-23-frame';">Micro - 2"-3" Frame</span></li><li><span x-cms-id="517" onclick="self.location='/shop/cat:frames-4-frame';">4" Frame</span></li><li><span x-cms-id="518" onclick="self.location='/shop/cat:frames-5-frame';">5" Frame</span></li><li><span x-cms-id="519" onclick="self.location='/shop/cat:frames-6-frame';">6" Frame</span></li><li><span x-cms-id="520" onclick="self.location='/shop/cat:frames-7-frame';">7" Frame</span></li><li><span x-cms-id="671" onclick="self.location='/shop/cat:frames-9-frame';">9" Frame</span></li><li><span x-cms-id="521" onclick="self.location='/shop/cat:frames-xclass';">X-Class</span></li><li style="line-height: 0; display: inline;">Frame Parts<ul><!-- start --><li><span x-cms-id="523" onclick="self.location='/shop/cat:frames-frame-parts-source-one';">Source one</span></li><li><span x-cms-id="524" onclick="self.location='/shop/cat:frames-frame-parts-source-two';">Source two</span></li><li><span x-cms-id="525" onclick="self.location='/shop/cat:frames-frame-parts-source-v';">Source V</span></li><li><span x-cms-id="526" onclick="self.location='/shop/cat:frames-frame-parts-source-micro';">Source Micro</span></li><li><span x-cms-id="527" onclick="self.location='/shop/cat:frames-frame-parts-source-x';">Source X</span></li><li><span x-cms-id="656" onclick="self.location='/shop/cat:frames-frame-parts-source-podracer';">Source Podracer</span></li><li><span x-cms-id="658" onclick="self.location='/shop/cat:frames-frame-parts-oblivion';">Oblivion</span></li><!-- end --></ul></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Electronics<ul><!-- start --><li><span x-cms-id="529" onclick="self.location='/shop/cat:electronics-flight-controllers-fc';">Flight Controllers (FC)</span></li><li><span x-cms-id="530" onclick="self.location='/shop/cat:electronics-electronic-speed-controllers-esc';">Electronic Speed Controllers (ESC)</span></li><li><span x-cms-id="531" onclick="self.location='/shop/cat:electronics-stacks';">Stacks</span></li><li><span x-cms-id="532" onclick="self.location='/shop/cat:electronics-aioinone';">AIO (All-in-one)</span></li><li><span x-cms-id="533" onclick="self.location='/shop/cat:electronics-pdb-osd-bec';">PDB / OSD / BEC</span></li><li><span x-cms-id="534" onclick="self.location='/shop/cat:electronics-leds';">LEDs</span></li><li><span x-cms-id="535" onclick="self.location='/shop/cat:electronics-gps';">GPS</span></li><li><span x-cms-id="536" onclick="self.location='/shop/cat:electronics-mounting-boards';">Mounting Boards</span></li><li><span x-cms-id="537" onclick="self.location='/shop/cat:electronics-capacitors';">Capacitors</span></li><li style="line-height: 0; display: inline;">HD Camera<ul><!-- start --><li><span x-cms-id="649" onclick="self.location='/shop/cat:electronics-hd-camera-accessories';">Accessories</span></li><!-- end --></ul></li><li><span x-cms-id="647" onclick="self.location='/shop/cat:electronics-misc';">MISC</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">FPV Equipment<ul><!-- start --><li style="line-height: 0; display: inline;">VTX<ul><!-- start --><li><span x-cms-id="540" onclick="self.location='/shop/cat:fpv-equipment-vtx-1g3';">1G3</span></li><li><span x-cms-id="541" onclick="self.location='/shop/cat:fpv-equipment-vtx-2g4';">2G4</span></li><li><span x-cms-id="542" onclick="self.location='/shop/cat:fpv-equipment-vtx-5g8';">5G8</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">VRX<ul><!-- start --><li><span x-cms-id="544" onclick="self.location='/shop/cat:fpv-equipment-vrx-1g3';">1G3</span></li><li><span x-cms-id="545" onclick="self.location='/shop/cat:fpv-equipment-vrx-2g4';">2G4</span></li><li><span x-cms-id="546" onclick="self.location='/shop/cat:fpv-equipment-vrx-5g8';">5G8</span></li><!-- end --></ul></li><li><span x-cms-id="669" onclick="self.location='/shop/cat:fpv-equipment-hdsys';">HD</span></li><li style="line-height: 0; display: inline;">Goggles<ul><!-- start --><li><span x-cms-id="548" onclick="self.location='/shop/cat:fpv-equipment-goggles-batteries';">Batteries</span></li><li><span x-cms-id="549" onclick="self.location='/shop/cat:fpv-equipment-goggles-accessories';">Accessories</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Screens<ul><!-- start --><li><span x-cms-id="551" onclick="self.location='/shop/cat:fpv-equipment-screens-batteries';">Batteries</span></li><li><span x-cms-id="552" onclick="self.location='/shop/cat:fpv-equipment-screens-accessories';">Accessories</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Antennas<ul><!-- start --><li><span x-cms-id="554" onclick="self.location='/shop/cat:fpv-equipment-antennas-1g3';">1G3</span></li><li><span x-cms-id="555" onclick="self.location='/shop/cat:fpv-equipment-antennas-2g4';">2G4</span></li><li style="line-height: 0; display: inline;">5G8<ul><!-- start --><li><span x-cms-id="664" onclick="self.location='/shop/cat:fpv-equipment-antennas-5g8-omni-directional';">Omni Directional</span></li><li><span x-cms-id="665" onclick="self.location='/shop/cat:fpv-equipment-antennas-5g8-directional';">Directional</span></li><!-- end --></ul></li><li><span x-cms-id="653" onclick="self.location='/shop/cat:fpv-equipment-antennas-adapters-filters';">Adapters & Filters</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">FPV Cameras<ul><!-- start --><li><span x-cms-id="657" onclick="self.location='/shop/cat:fpv-equipment-fpv-cameras-whoop';">Whoop</span></li><li><span x-cms-id="558" onclick="self.location='/shop/cat:fpv-equipment-fpv-cameras-14mm';">14mm</span></li><li><span x-cms-id="559" onclick="self.location='/shop/cat:fpv-equipment-fpv-cameras-19mm';">19mm</span></li><li><span x-cms-id="560" onclick="self.location='/shop/cat:fpv-equipment-fpv-cameras-2122mm';">21-22mm</span></li><li><span x-cms-id="561" onclick="self.location='/shop/cat:fpv-equipment-fpv-cameras-26mm';">26mm</span></li><li><span x-cms-id="562" onclick="self.location='/shop/cat:fpv-equipment-fpv-cameras-camera-parts';">Camera Parts</span></li><!-- end --></ul></li><li><span x-cms-id="563" onclick="self.location='/shop/cat:fpv-equipment-osd';">OSD</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">RC Link<ul><!-- start --><li style="line-height: 0; display: inline;">Radio<ul><!-- start --><li><span x-cms-id="566" onclick="self.location='/shop/cat:rc-link-radio-accessories';">Accessories</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">TX Modules<ul><!-- start --><li><span x-cms-id="568" onclick="self.location='/shop/cat:rc-link-tx-modules-2g4';">2G4</span></li><li><span x-cms-id="569" onclick="self.location='/shop/cat:rc-link-tx-moduldes-868915';">868/915</span></li><li><span x-cms-id="570" onclick="self.location='/shop/cat:rc-link-tx-moduldes-accessories';">Accessories</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Receivers<ul><!-- start --><li><span x-cms-id="572" onclick="self.location='/shop/cat:rc-link-receivers-2g4';">2G4</span></li><li><span x-cms-id="573" onclick="self.location='/shop/cat:rc-link-receivers-868915';">868/915</span></li><li><span x-cms-id="574" onclick="self.location='/shop/cat:rc-link-receivers-accessories';">Accessories</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Antennas<ul><!-- start --><li><span x-cms-id="651" onclick="self.location='/shop/cat:rc-link-antennas-433';">433</span></li><li><span x-cms-id="576" onclick="self.location='/shop/cat:rc-link-antennas-2g4';">2G4</span></li><li><span x-cms-id="577" onclick="self.location='/shop/cat:rc-link-antennas-868915';">868/915</span></li><!-- end --></ul></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">TBS Crossfire<ul><!-- start --><li><span x-cms-id="442" onclick="self.location='/shop/cat:tbs-crossfire-radio-transmitter';">Radio Transmitter (Tx)</span></li><li><span x-cms-id="443" onclick="self.location='/shop/cat:tbs-crossfire-radio-receivers';">Radio Receivers</span></li><!-- end --></ul></li><li><span x-cms-id="441" onclick="self.location='/shop/cat:cat_tracer';">TBS TRACER</span></li><li style="line-height: 0; display: inline;">Props<ul><!-- start --><li><span x-cms-id="579" onclick="self.location='/shop/cat:props-sub-2-props';">Sub 2" Props</span></li><li><span x-cms-id="580" onclick="self.location='/shop/cat:props-2-props';">2" Props</span></li><li><span x-cms-id="668" onclick="self.location='/shop/cat:props-2pt5-props';">2.5" Props</span></li><li><span x-cms-id="581" onclick="self.location='/shop/cat:props-3-props';">3" Props</span></li><li><span x-cms-id="582" onclick="self.location='/shop/cat:props-4-props';">4" Props</span></li><li><span x-cms-id="583" onclick="self.location='/shop/cat:props-5-props';">5" Props</span></li><li><span x-cms-id="584" onclick="self.location='/shop/cat:props-6-props';">6" Props</span></li><li><span x-cms-id="585" onclick="self.location='/shop/cat:props-7-props';">7" Props</span></li><li><span x-cms-id="586" onclick="self.location='/shop/cat:props-8-props';">8" Props</span></li><li><span x-cms-id="587" onclick="self.location='/shop/cat:props-9-props';">9" Props</span></li><li><span x-cms-id="588" onclick="self.location='/shop/cat:props-10-props';">10" Props</span></li><li><span x-cms-id="589" onclick="self.location='/shop/cat:props-13-props';">13" Props</span></li><li><span x-cms-id="590" onclick="self.location='/shop/cat:props-14-props';">14" Props</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Battery<ul><!-- start --><li><span x-cms-id="592" onclick="self.location='/shop/cat:battery-chargers-and-accessories';">Chargers and accessories</span></li><li><span x-cms-id="593" onclick="self.location='/shop/cat:battery-straps-and-pads';">Straps and Pads</span></li><li><span x-cms-id="594" onclick="self.location='/shop/cat:battery-1s';">1S</span></li><li><span x-cms-id="595" onclick="self.location='/shop/cat:battery-2s';">2S</span></li><li><span x-cms-id="596" onclick="self.location='/shop/cat:battery-3s';">3S</span></li><li><span x-cms-id="597" onclick="self.location='/shop/cat:battery-4s';">4S</span></li><li><span x-cms-id="598" onclick="self.location='/shop/cat:battery-5s';">5S</span></li><li><span x-cms-id="599" onclick="self.location='/shop/cat:battery-6s';">6S</span></li><li><span x-cms-id="600" onclick="self.location='/shop/cat:battery-7s';">7S+</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Motors<ul><!-- start --><li><span x-cms-id="655" onclick="self.location='/shop/cat:motors-brushed';">Brushed</span></li><li><span x-cms-id="602" onclick="self.location='/shop/cat:motors-08xx';">08XX</span></li><li><span x-cms-id="603" onclick="self.location='/shop/cat:motors-11xx';">11XX</span></li><li><span x-cms-id="604" onclick="self.location='/shop/cat:motors-12xx';">12XX</span></li><li><span x-cms-id="605" onclick="self.location='/shop/cat:motors-13xx';">13XX</span></li><li><span x-cms-id="606" onclick="self.location='/shop/cat:motors-14xx';">14XX</span></li><li><span x-cms-id="607" onclick="self.location='/shop/cat:motors-15xx';">15XX</span></li><li><span x-cms-id="608" onclick="self.location='/shop/cat:motors-16xx';">16XX</span></li><li><span x-cms-id="609" onclick="self.location='/shop/cat:motors-18xx';">18XX</span></li><li><span x-cms-id="610" onclick="self.location='/shop/cat:motors-20xx';">20XX</span></li><li><span x-cms-id="611" onclick="self.location='/shop/cat:motors-22xx';">22XX</span></li><li><span x-cms-id="612" onclick="self.location='/shop/cat:motors-23xx';">23XX</span></li><li><span x-cms-id="613" onclick="self.location='/shop/cat:motors-24xx';">24XX</span></li><li><span x-cms-id="675" onclick="self.location='/shop/cat:motors-25xx';">25XX</span></li><li><span x-cms-id="614" onclick="self.location='/shop/cat:motors-28xx';">28XX</span></li><li><span x-cms-id="674" onclick="self.location='/shop/cat:motors-30xx';">30XX</span></li><li><span x-cms-id="673" onclick="self.location='/shop/cat:motors-31xx';">31XX</span></li><li><span x-cms-id="615" onclick="self.location='/shop/cat:motors-xclass';">XClass</span></li><li><span x-cms-id="616" onclick="self.location='/shop/cat:motors-accessories';">Accessories</span></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Wings<ul><!-- start --><li><span x-cms-id="618" onclick="self.location='/shop/cat:wings-body';">Body</span></li><li><span x-cms-id="619" onclick="self.location='/shop/cat:wings-kits';">Kits</span></li><li><span x-cms-id="620" onclick="self.location='/shop/cat:wings-pnp';">PNP</span></li><li><span x-cms-id="621" onclick="self.location='/shop/cat:wings-electronics';">Electronics</span></li><li><span x-cms-id="622" onclick="self.location='/shop/cat:wings-motors';">Motors</span></li><li><span x-cms-id="623" onclick="self.location='/shop/cat:wings-servos';">Servos</span></li><li><span x-cms-id="646" onclick="self.location='/shop/cat:wings-props';">Props</span></li><li><span x-cms-id="624" onclick="self.location='/shop/cat:wings-accessories';">Accessories</span></li><li style="line-height: 0; display: inline;">Spare Parts<ul><!-- start --><li><span x-cms-id="626" onclick="self.location='/shop/cat:wings-spare-parts-tbs-caipirinha-2';">TBS Caipirinha 2</span></li><!-- end --></ul></li><!-- end --></ul></li><li style="line-height: 0; display: inline;">Hardware and Tools<ul><!-- start --><li><span x-cms-id="628" onclick="self.location='/shop/cat:hardware-and-tools-soldering';">Soldering</span></li><li><span x-cms-id="629" onclick="self.location='/shop/cat:hardware-and-tools-screw-drivers';">Screw Drivers</span></li><li><span x-cms-id="630" onclick="self.location='/shop/cat:hardware-and-tools-screws';">Screws</span></li><li><span x-cms-id="666" onclick="self.location='/shop/cat:hardware-and-tools-ndfilter';">ND Filters</span></li><li><span x-cms-id="631" onclick="self.location='/shop/cat:hardware-and-tools-straps';">Straps</span></li><li><span x-cms-id="632" onclick="self.location='/shop/cat:hardware-and-tools-prop-tools';">Prop Tools</span></li><li><span x-cms-id="633" onclick="self.location='/shop/cat:hardware-and-tools-shrink-tubes';">Shrink Tubes</span></li><li><span x-cms-id="634" onclick="self.location='/shop/cat:hardware-and-tools-plugs-cables';">Plugs & Cables</span></li><li><span x-cms-id="635" onclick="self.location='/shop/cat:hardware-and-tools-awg-cables';">AWG Cables</span></li><li><span x-cms-id="645" onclick="self.location='/shop/cat:hardware-and-tools-adhesive';">Adhesive</span></li><li><span x-cms-id="652" onclick="self.location='/shop/cat:hardware-and-tools-race-track-equipment';">Race Track Equipment</span></li><li><span x-cms-id="650" onclick="self.location='/shop/cat:hardware-and-tools-misc';">Misc</span></li><!-- end --></ul></li><li><span x-cms-id="636" onclick="self.location='/shop/cat:software';">Software</span></li><li style="line-height: 0; display: inline;">Swag<ul><!-- start --><li><span x-cms-id="638" onclick="self.location='/shop/cat:swag-stickers';">Stickers</span></li><li><span x-cms-id="639" onclick="self.location='/shop/cat:swag-tshirts';">T-Shirts</span></li><li><span x-cms-id="640" onclick="self.location='/shop/cat:swag-hoodie';">Hoodie</span></li><li><span x-cms-id="641" onclick="self.location='/shop/cat:swag-hats';">Hats</span></li><li><span x-cms-id="654" onclick="self.location='/shop/cat:swag-bags';">Bags</span></li><li><span x-cms-id="642" onclick="self.location='/shop/cat:swag-other';">Other</span></li><!-- end --></ul></li><li><span x-cms-id="644" onclick="self.location='/shop/cat:clearance';">Clearance</span></li><li><span x-cms-id="360" onclick="self.location='/shop/cat:ethix';">ETHIX</span></li><li style="line-height: 0; display: inline;">FPVCycle<ul><!-- start --><li><span x-cms-id="437" onclick="self.location='/shop/cat:fpvcycle_4i';">4 Inch</span></li><li><span x-cms-id="438" onclick="self.location='/shop/cat:fpvcycle_5i';">5 Inch</span></li><li><span x-cms-id="439" onclick="self.location='/shop/cat:fpvcycle_sp_arm';">Spare Arms</span></li><!-- end --></ul></li><li><span x-cms-id="670" onclick="self.location='/shop/cat:cat_lessons';">LESSONS</span></li>							            </ul>
						        	</li>
									<li>
										<a data-toggle="collapse" href="#collapseSearch" role="button" aria-expanded="false" aria-controls="collapseSearch">
			    							<span id="slidebar_search" onclick="closeSlidebar();"><i class="fas fa-search fa-lg px-2 text-white"></i>SEARCH</span>
			    						</a>
									</li>
									<li><a href="/shop/cat:new"><i class="fab fa-hotjar fa-lg px-2 text-white"></i>NEW PRODUCTS</a></li>
					        	</ul>
					        </div>
					    </div>
					</div>
		            	
					<!-- you need to include the ShieldUI CSS and JS assets in order for the TreeView widget to work -->
					<link rel="stylesheet" type="text/css" href="/css/shieldui.css?v=1.0.1" />
					<script type="text/javascript" src="/js/shieldui.js?v=1.0.1"></script>

					<script type="text/javascript">
					    jQuery(function ($) {
					        $("#treeview").shieldTreeView();
					    });
					</script>
					<!-- Tree View - END -->
					<div class="pt-3">
						<hr class="hr-white">
					</div>
					<div class="pt-3 pl-3">
						<div class="pb-1"><a href="/simulator">SIMULATOR</a></div>
						<div class="pb-1"><a href="https://www.facebook.com/groups/BlackSheepLOUNGE/" target="_blank">COMMUNITY</a></div>
						<div class="pb-1"><a href="/contact">CONTACT</a></div>
						<div class="pb-1"><a href="/download/">DOWNLOAD</a></div>
					</div>
					                </ul>
            </div>
        </div>
    </div>

        <div class="overlay"></div>
<!-- END SIDEBAR -->

	
	<!--			<a href="//www.youtube.com/subscription_center?add_user=nastycop420" target="_blank"><img src="img/youtube_button.png" border="0" /></a>

		<a href="#" class="button icon-cart"><span>ADD TO CART</span></a>
		<a href="#" class="button icon-more"><span>MORE</span></a>

	-->

			<!-- Left thumbnail column -->
    <div class="content_left triplecol">
<style type="text/css"></style><div class="slickslider"><div style="overflow: visible;" class="banner_wrap"><a href=/shop/cat:cat_crossfire><img class="banner" src="/img/shopsets/1800_CROSSFIRE1.jpg"/></a> <img src="/img/shopsets/LOGO_blank.png" /><p id="product_text"></p></div><div class="banner_wrap"><a href=/shop/q:Mambo><img class="banner" style="display: none;" src="" image="/img/shopsets/1800_MAMBO1.jpg"/></a> <img src="/img/shopsets/LOGO_blank.png" /><p id="product_text"></p></div><div class="banner_wrap"><a href=/products/prod:tbs_tango2_pro><img class="banner" style="display: none;" src="" image="/img/shopsets/1800_TANGO_NOV.jpg"/></a> <img src="/img/shopsets/LOGO_blank.png" /><p id="product_text"></p></div><div class="banner_wrap"><a href=/shop/cat:cat_tracer><img class="banner" style="display: none;" src="" image="/img/shopsets/1800_TRACER2.jpg"/></a> <img src="/img/shopsets/LOGO_blank.png" /><p id="product_text"></p></div><div class="banner_wrap"><a href=/products/prod:tbs_caipi2_pnp><img class="banner" style="display: none;" src="" image="/img/shopsets/1800_CAIPIw.jpg"/></a> <img src="/img/shopsets/LOGO_blank.png" /><p id="product_text"></p></div><div class="banner_wrap"><a href=/products/prod:oblivion_full_set><img class="banner" style="display: none;" src="" image="/img/shopsets/1800_OBLIVION1.jpg"/></a> <img src="/img/shopsets/LOGO_blank.png" /><p id="product_text"></p></div><div class="banner_wrap"><a href=/shop/q:whoop%20nano><img class="banner" style="display: none;" src="" image="/img/shopsets/1800_WHOOP1.jpg"/></a> <img src="/img/shopsets/LOGO_blank.png" /><p id="product_text"></p></div></div><script type="text/javascript">$(document).ready(function() {
	$('#carousel').bxSlider({});
	$('#carousel .callout').prepend(
		$("<img src='/img/nav_slider_left.svg' class='carousel-arrow-left' /><img src='/img/nav_slider_right.svg' class='carousel-arrow-right' />")
	);

	$(document).on("click", '.carousel-arrow-left', function() { $('a.bx-prev').click(); });
	$(document).on("click", '.carousel-arrow-right', function() { $('a.bx-next').click(); });

});


;(function($) {

  var defaults = {

    // GENERAL
    mode: 'horizontal',
    slideSelector: '',
    infiniteLoop: true,
    hideControlOnEnd: false,
    speed: 500,
    easing: null,
    slideMargin: 0,
    startSlide: 0,
    randomStart: false,
    captions: false,
    ticker: false,
    tickerHover: false,
    adaptiveHeight: false,
    adaptiveHeightSpeed: 500,
    video: false,
    useCSS: true,
    preloadImages: 'visible',
    responsive: true,
    slideZIndex: 50,
    wrapperClass: 'bx-wrapper',

    // TOUCH
    touchEnabled: true,
    swipeThreshold: 50,
    oneToOneTouch: true,
    preventDefaultSwipeX: true,
    preventDefaultSwipeY: false,

    // ACCESSIBILITY
    ariaLive: true,
    ariaHidden: true,

    // KEYBOARD
    keyboardEnabled: false,

    // PAGER
    pager: true,
    pagerType: 'full',
    pagerShortSeparator: ' / ',
    pagerSelector: null,
    buildPager: null,
    pagerCustom: null,

    // CONTROLS
    controls: true,
    nextText: 'Next',
    prevText: 'Prev',
    nextSelector: null,
    prevSelector: null,
    autoControls: false,
    startText: 'Start',
    stopText: 'Stop',
    autoControlsCombine: false,
    autoControlsSelector: null,

    // AUTO
    auto: false,
    pause: 4000,
    autoStart: true,
    autoDirection: 'next',
    stopAutoOnClick: false,
    autoHover: false,
    autoDelay: 0,
    autoSlideForOnePage: false,

    // CAROUSEL
    minSlides: 1,
    maxSlides: 1,
    moveSlides: 0,
    slideWidth: 0,
    shrinkItems: false,

    // CALLBACKS
    onSliderLoad: function() { return true; },
    onSlideBefore: function() { return true; },
    onSlideAfter: function() { return true; },
    onSlideNext: function() { return true; },
    onSlidePrev: function() { return true; },
    onSliderResize: function() { return true; }
  };

  $.fn.bxSlider = function(options) {

    if (this.length === 0) {
      return this;
    }

    // support multiple elements
    if (this.length > 1) {
      this.each(function() {
        $(this).bxSlider(options);
      });
      return this;
    }

    // create a namespace to be used throughout the plugin
    var slider = {},
    // set a reference to our slider element
    el = this,
    // get the original window dimens (thanks a lot IE)
    windowWidth = $(window).width(),
    windowHeight = $(window).height();

    // Return if slider is already initialized
    if ($(el).data('bxSlider')) { return; }

    /**
     * ===================================================================================
     * = PRIVATE FUNCTIONS
     * ===================================================================================
     */

    /**
     * Initializes namespace settings to be used throughout plugin
     */
    var init = function() {
      // Return if slider is already initialized
      if ($(el).data('bxSlider')) { return; }
      // merge user-supplied options with the defaults
      slider.settings = $.extend({}, defaults, options);
      // parse slideWidth setting
      slider.settings.slideWidth = parseInt(slider.settings.slideWidth);
      // store the original children
      slider.children = el.children(slider.settings.slideSelector);
      // check if actual number of slides is less than minSlides / maxSlides
      if (slider.children.length < slider.settings.minSlides) { slider.settings.minSlides = slider.children.length; }
      if (slider.children.length < slider.settings.maxSlides) { slider.settings.maxSlides = slider.children.length; }
      // if random start, set the startSlide setting to random number
      if (slider.settings.randomStart) { slider.settings.startSlide = Math.floor(Math.random() * slider.children.length); }
      // store active slide information
      slider.active = { index: slider.settings.startSlide };
      // store if the slider is in carousel mode (displaying / moving multiple slides)
      slider.carousel = slider.settings.minSlides > 1 || slider.settings.maxSlides > 1 ? true : false;
      // if carousel, force preloadImages = 'all'
      if (slider.carousel) { slider.settings.preloadImages = 'all'; }
      // calculate the min / max width thresholds based on min / max number of slides
      // used to setup and update carousel slides dimensions
      slider.minThreshold = (slider.settings.minSlides * slider.settings.slideWidth) + ((slider.settings.minSlides - 1) * slider.settings.slideMargin);
      slider.maxThreshold = (slider.settings.maxSlides * slider.settings.slideWidth) + ((slider.settings.maxSlides - 1) * slider.settings.slideMargin);
      // store the current state of the slider (if currently animating, working is true)
      slider.working = false;
      // initialize the controls object
      slider.controls = {};
      // initialize an auto interval
      slider.interval = null;
      // determine which property to use for transitions
      slider.animProp = slider.settings.mode === 'vertical' ? 'top' : 'left';
      // determine if hardware acceleration can be used
      slider.usingCSS = slider.settings.useCSS && slider.settings.mode !== 'fade' && (function() {
        // create our test div element
        var div = document.createElement('div'),
        // css transition properties
        props = ['WebkitPerspective', 'MozPerspective', 'OPerspective', 'msPerspective'];
        // test for each property
        for (var i = 0; i < props.length; i++) {
          if (div.style[props[i]] !== undefined) {
            slider.cssPrefix = props[i].replace('Perspective', '').toLowerCase();
            slider.animProp = '-' + slider.cssPrefix + '-transform';
            return true;
          }
        }
        return false;
      }());
      // if vertical mode always make maxSlides and minSlides equal
      if (slider.settings.mode === 'vertical') { slider.settings.maxSlides = slider.settings.minSlides; }
      // save original style data
      el.data('origStyle', el.attr('style'));
      el.children(slider.settings.slideSelector).each(function() {
        $(this).data('origStyle', $(this).attr('style'));
      });

      // perform all DOM / CSS modifications
      setup();
    };

    /**
     * Performs all DOM and CSS modifications
     */
    var setup = function() {
      var preloadSelector = slider.children.eq(slider.settings.startSlide); // set the default preload selector (visible)

      // wrap el in a wrapper
      el.wrap('<div class="' + slider.settings.wrapperClass + '"><div class="bx-viewport"></div></div>');
      // store a namespace reference to .bx-viewport
      slider.viewport = el.parent();

      // add aria-live if the setting is enabled and ticker mode is disabled
      if (slider.settings.ariaLive && !slider.settings.ticker) {
        slider.viewport.attr('aria-live', 'polite');
      }
      // add a loading div to display while images are loading
      slider.loader = $('<div class="bx-loading" />');
      slider.viewport.prepend(slider.loader);
      // set el to a massive width, to hold any needed slides
      // also strip any margin and padding from el
      el.css({
        width: slider.settings.mode === 'horizontal' ? (slider.children.length * 1000 + 215) + '%' : 'auto',
        position: 'relative'
      });
      // if using CSS, add the easing property
      if (slider.usingCSS && slider.settings.easing) {
        el.css('-' + slider.cssPrefix + '-transition-timing-function', slider.settings.easing);
      // if not using CSS and no easing value was supplied, use the default JS animation easing (swing)
      } else if (!slider.settings.easing) {
        slider.settings.easing = 'swing';
      }
      // make modifications to the viewport (.bx-viewport)
      slider.viewport.css({
        width: '100%',
        overflow: 'hidden',
        position: 'relative'
      });
      slider.viewport.parent().css({
        maxWidth: getViewportMaxWidth()
      });
      // make modification to the wrapper (.bx-wrapper)
      if (!slider.settings.pager && !slider.settings.controls) {
        slider.viewport.parent().css({
          margin: '0 auto 0px'
        });
      }
      // apply css to all slider children
      slider.children.css({
        float: slider.settings.mode === 'horizontal' ? 'left' : 'none',
        listStyle: 'none',
        position: 'relative'
      });
      // apply the calculated width after the float is applied to prevent scrollbar interference
      slider.children.css('width', getSlideWidth());
      // if slideMargin is supplied, add the css
      if (slider.settings.mode === 'horizontal' && slider.settings.slideMargin > 0) { slider.children.css('marginRight', slider.settings.slideMargin); }
      if (slider.settings.mode === 'vertical' && slider.settings.slideMargin > 0) { slider.children.css('marginBottom', slider.settings.slideMargin); }
      // if "fade" mode, add positioning and z-index CSS
      if (slider.settings.mode === 'fade') {
        slider.children.css({
          position: 'absolute',
          zIndex: 0,
          display: 'none'
        });
        // prepare the z-index on the showing element
        slider.children.eq(slider.settings.startSlide).css({zIndex: slider.settings.slideZIndex, display: 'block'});
      }
      // create an element to contain all slider controls (pager, start / stop, etc)
      slider.controls.el = $('<div class="bx-controls" />');
      // if captions are requested, add them
      if (slider.settings.captions) { appendCaptions(); }
      // check if startSlide is last slide
      slider.active.last = slider.settings.startSlide === getPagerQty() - 1;
      // if video is true, set up the fitVids plugin
      if (slider.settings.video) { el.fitVids(); }
      if (slider.settings.preloadImages === 'all' || slider.settings.ticker) { preloadSelector = slider.children; }
      // only check for control addition if not in "ticker" mode
      if (!slider.settings.ticker) {
        // if controls are requested, add them
        if (slider.settings.controls) { appendControls(); }
        // if auto is true, and auto controls are requested, add them
        if (slider.settings.auto && slider.settings.autoControls) { appendControlsAuto(); }
        // if pager is requested, add it
        if (slider.settings.pager) { appendPager(); }
        // if any control option is requested, add the controls wrapper
        if (slider.settings.controls || slider.settings.autoControls || slider.settings.pager) { slider.viewport.after(slider.controls.el); }
      // if ticker mode, do not allow a pager
      } else {
        slider.settings.pager = false;
      }
      loadElements(preloadSelector, start);
    };

    var loadElements = function(selector, callback) {
      var total = selector.find('img:not([src=""]), iframe').length,
      count = 0;
      if (total === 0) {
        callback();
        return;
      }
      selector.find('img:not([src=""]), iframe').each(function() {
        $(this).one('load error', function() {
          if (++count === total) { callback(); }
        }).each(function() {
          if (this.complete) { $(this).load(); }
        });
      });
    };

    /**
     * Start the slider
     */
    var start = function() {
      // if infinite loop, prepare additional slides
      if (slider.settings.infiniteLoop && slider.settings.mode !== 'fade' && !slider.settings.ticker) {
        var slice    = slider.settings.mode === 'vertical' ? slider.settings.minSlides : slider.settings.maxSlides,
        sliceAppend  = slider.children.slice(0, slice).clone(true).addClass('bx-clone'),
        slicePrepend = slider.children.slice(-slice).clone(true).addClass('bx-clone');
        if (slider.settings.ariaHidden) {
          sliceAppend.attr('aria-hidden', true);
          slicePrepend.attr('aria-hidden', true);
        }
        el.append(sliceAppend).prepend(slicePrepend);
      }
      // remove the loading DOM element
      slider.loader.remove();
      // set the left / top position of "el"
      setSlidePosition();
      // if "vertical" mode, always use adaptiveHeight to prevent odd behavior
      if (slider.settings.mode === 'vertical') { slider.settings.adaptiveHeight = true; }
      // set the viewport height
      slider.viewport.height(getViewportHeight());
      // make sure everything is positioned just right (same as a window resize)
      el.redrawSlider();
      // onSliderLoad callback
      slider.settings.onSliderLoad.call(el, slider.active.index);
      // slider has been fully initialized
      slider.initialized = true;
      // bind the resize call to the window
      if (slider.settings.responsive) { $(window).bind('resize', resizeWindow); }
      // if auto is true and has more than 1 page, start the show
      if (slider.settings.auto && slider.settings.autoStart && (getPagerQty() > 1 || slider.settings.autoSlideForOnePage)) { initAuto(); }
      // if ticker is true, start the ticker
      if (slider.settings.ticker) { initTicker(); }
      // if pager is requested, make the appropriate pager link active
      if (slider.settings.pager) { updatePagerActive(slider.settings.startSlide); }
      // check for any updates to the controls (like hideControlOnEnd updates)
      if (slider.settings.controls) { updateDirectionControls(); }
      // if touchEnabled is true, setup the touch events
      if (slider.settings.touchEnabled && !slider.settings.ticker) { initTouch(); }
      // if keyboardEnabled is true, setup the keyboard events
      if (slider.settings.keyboardEnabled && !slider.settings.ticker) {
        $(document).keydown(keyPress);
      }
    };

    /**
     * Returns the calculated height of the viewport, used to determine either adaptiveHeight or the maxHeight value
     */
    var getViewportHeight = function() {
      var height = 0;
      // first determine which children (slides) should be used in our height calculation
      var children = $();
      // if mode is not "vertical" and adaptiveHeight is false, include all children
      if (slider.settings.mode !== 'vertical' && !slider.settings.adaptiveHeight) {
        children = slider.children;
      } else {
        // if not carousel, return the single active child
        if (!slider.carousel) {
          children = slider.children.eq(slider.active.index);
        // if carousel, return a slice of children
        } else {
          // get the individual slide index
          var currentIndex = slider.settings.moveSlides === 1 ? slider.active.index : slider.active.index * getMoveBy();
          // add the current slide to the children
          children = slider.children.eq(currentIndex);
          // cycle through the remaining "showing" slides
          for (i = 1; i <= slider.settings.maxSlides - 1; i++) {
            // if looped back to the start
            if (currentIndex + i >= slider.children.length) {
              children = children.add(slider.children.eq(i - 1));
            } else {
              children = children.add(slider.children.eq(currentIndex + i));
            }
          }
        }
      }
      // if "vertical" mode, calculate the sum of the heights of the children
      if (slider.settings.mode === 'vertical') {
        children.each(function(index) {
          height += $(this).outerHeight();
        });
        // add user-supplied margins
        if (slider.settings.slideMargin > 0) {
          height += slider.settings.slideMargin * (slider.settings.minSlides - 1);
        }
      // if not "vertical" mode, calculate the max height of the children
      } else {
        height = Math.max.apply(Math, children.map(function() {
          return $(this).outerHeight(false);
        }).get());
      }

      if (slider.viewport.css('box-sizing') === 'border-box') {
        height += parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom')) +
              parseFloat(slider.viewport.css('border-top-width')) + parseFloat(slider.viewport.css('border-bottom-width'));
      } else if (slider.viewport.css('box-sizing') === 'padding-box') {
        height += parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom'));
      }

      return height;
    };

    /**
     * Returns the calculated width to be used for the outer wrapper / viewport
     */
    var getViewportMaxWidth = function() {
      var width = '100%';
      if (slider.settings.slideWidth > 0) {
        if (slider.settings.mode === 'horizontal') {
          width = (slider.settings.maxSlides * slider.settings.slideWidth) + ((slider.settings.maxSlides - 1) * slider.settings.slideMargin);
        } else {
          width = slider.settings.slideWidth;
        }
      }
      return width;
    };

    /**
     * Returns the calculated width to be applied to each slide
     */
    var getSlideWidth = function() {
      var newElWidth = slider.settings.slideWidth, // start with any user-supplied slide width
      wrapWidth      = slider.viewport.width();    // get the current viewport width
      // if slide width was not supplied, or is larger than the viewport use the viewport width
      if (slider.settings.slideWidth === 0 ||
        (slider.settings.slideWidth > wrapWidth && !slider.carousel) ||
        slider.settings.mode === 'vertical') {
        newElWidth = wrapWidth;
      // if carousel, use the thresholds to determine the width
      } else if (slider.settings.maxSlides > 1 && slider.settings.mode === 'horizontal') {
        if (wrapWidth > slider.maxThreshold) {
          return newElWidth;
        } else if (wrapWidth < slider.minThreshold) {
          newElWidth = (wrapWidth - (slider.settings.slideMargin * (slider.settings.minSlides - 1))) / slider.settings.minSlides;
        } else if (slider.settings.shrinkItems) {
          newElWidth = Math.floor((wrapWidth + slider.settings.slideMargin) / (Math.ceil((wrapWidth + slider.settings.slideMargin) / (newElWidth + slider.settings.slideMargin))) - slider.settings.slideMargin);
        }
      }
      return newElWidth;
    };

    /**
     * Returns the number of slides currently visible in the viewport (includes partially visible slides)
     */
    var getNumberSlidesShowing = function() {
      var slidesShowing = 1,
      childWidth = null;
      if (slider.settings.mode === 'horizontal' && slider.settings.slideWidth > 0) {
        // if viewport is smaller than minThreshold, return minSlides
        if (slider.viewport.width() < slider.minThreshold) {
          slidesShowing = slider.settings.minSlides;
        // if viewport is larger than maxThreshold, return maxSlides
        } else if (slider.viewport.width() > slider.maxThreshold) {
          slidesShowing = slider.settings.maxSlides;
        // if viewport is between min / max thresholds, divide viewport width by first child width
        } else {
          childWidth = slider.children.first().width() + slider.settings.slideMargin;
          slidesShowing = Math.floor((slider.viewport.width() +
            slider.settings.slideMargin) / childWidth);
        }
      // if "vertical" mode, slides showing will always be minSlides
      } else if (slider.settings.mode === 'vertical') {
        slidesShowing = slider.settings.minSlides;
      }
      return slidesShowing;
    };

    /**
     * Returns the number of pages (one full viewport of slides is one "page")
     */
    var getPagerQty = function() {
      var pagerQty = 0,
      breakPoint = 0,
      counter = 0;
      // if moveSlides is specified by the user
      if (slider.settings.moveSlides > 0) {
        if (slider.settings.infiniteLoop) {
          pagerQty = Math.ceil(slider.children.length / getMoveBy());
        } else {
          // when breakpoint goes above children length, counter is the number of pages
          while (breakPoint < slider.children.length) {
            ++pagerQty;
            breakPoint = counter + getNumberSlidesShowing();
            counter += slider.settings.moveSlides <= getNumberSlidesShowing() ? slider.settings.moveSlides : getNumberSlidesShowing();
          }
        }
      // if moveSlides is 0 (auto) divide children length by sides showing, then round up
      } else {
        pagerQty = Math.ceil(slider.children.length / getNumberSlidesShowing());
      }
      return pagerQty;
    };

    /**
     * Returns the number of individual slides by which to shift the slider
     */
    var getMoveBy = function() {
      // if moveSlides was set by the user and moveSlides is less than number of slides showing
      if (slider.settings.moveSlides > 0 && slider.settings.moveSlides <= getNumberSlidesShowing()) {
        return slider.settings.moveSlides;
      }
      // if moveSlides is 0 (auto)
      return getNumberSlidesShowing();
    };

    /**
     * Sets the slider's (el) left or top position
     */
    var setSlidePosition = function() {
      var position, lastChild, lastShowingIndex;
      // if last slide, not infinite loop, and number of children is larger than specified maxSlides
      if (slider.children.length > slider.settings.maxSlides && slider.active.last && !slider.settings.infiniteLoop) {
        if (slider.settings.mode === 'horizontal') {
          // get the last child's position
          lastChild = slider.children.last();
          position = lastChild.position();
          // set the left position
          setPositionProperty(-(position.left - (slider.viewport.width() - lastChild.outerWidth())), 'reset', 0);
        } else if (slider.settings.mode === 'vertical') {
          // get the last showing index's position
          lastShowingIndex = slider.children.length - slider.settings.minSlides;
          position = slider.children.eq(lastShowingIndex).position();
          // set the top position
          setPositionProperty(-position.top, 'reset', 0);
        }
      // if not last slide
      } else {
        // get the position of the first showing slide
        position = slider.children.eq(slider.active.index * getMoveBy()).position();
        // check for last slide
        if (slider.active.index === getPagerQty() - 1) { slider.active.last = true; }
        // set the respective position
        if (position !== undefined) {
          if (slider.settings.mode === 'horizontal') { setPositionProperty(-position.left, 'reset', 0); }
          else if (slider.settings.mode === 'vertical') { setPositionProperty(-position.top, 'reset', 0); }
        }
      }
    };

    /**
     * Sets the el's animating property position (which in turn will sometimes animate el).
     * If using CSS, sets the transform property. If not using CSS, sets the top / left property.
     *
     * @param value (int)
     *  - the animating property's value
     *
     * @param type (string) 'slide', 'reset', 'ticker'
     *  - the type of instance for which the function is being
     *
     * @param duration (int)
     *  - the amount of time (in ms) the transition should occupy
     *
     * @param params (array) optional
     *  - an optional parameter containing any variables that need to be passed in
     */
    var setPositionProperty = function(value, type, duration, params) {
      var animateObj, propValue;
      // use CSS transform
      if (slider.usingCSS) {
        // determine the translate3d value
        propValue = slider.settings.mode === 'vertical' ? 'translate3d(0, ' + value + 'px, 0)' : 'translate3d(' + value + 'px, 0, 0)';
        // add the CSS transition-duration
        el.css('-' + slider.cssPrefix + '-transition-duration', duration / 1000 + 's');
        if (type === 'slide') {
          // set the property value
          el.css(slider.animProp, propValue);
          if (duration !== 0) {
            // bind a callback method - executes when CSS transition completes
            el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(e) {
              //make sure it's the correct one
              if (!$(e.target).is(el)) { return; }
              // unbind the callback
              el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
              updateAfterSlideTransition();
            });
          } else { //duration = 0
            updateAfterSlideTransition();
          }
        } else if (type === 'reset') {
          el.css(slider.animProp, propValue);
        } else if (type === 'ticker') {
          // make the transition use 'linear'
          el.css('-' + slider.cssPrefix + '-transition-timing-function', 'linear');
          el.css(slider.animProp, propValue);
          if (duration !== 0) {
            el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(e) {
              //make sure it's the correct one
              if (!$(e.target).is(el)) { return; }
              // unbind the callback
              el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
              // reset the position
              setPositionProperty(params.resetValue, 'reset', 0);
              // start the loop again
              tickerLoop();
            });
          } else { //duration = 0
            setPositionProperty(params.resetValue, 'reset', 0);
            tickerLoop();
          }
        }
      // use JS animate
      } else {
        animateObj = {};
        animateObj[slider.animProp] = value;
        if (type === 'slide') {
          el.animate(animateObj, duration, slider.settings.easing, function() {
            updateAfterSlideTransition();
          });
        } else if (type === 'reset') {
          el.css(slider.animProp, value);
        } else if (type === 'ticker') {
          el.animate(animateObj, duration, 'linear', function() {
            setPositionProperty(params.resetValue, 'reset', 0);
            // run the recursive loop after animation
            tickerLoop();
          });
        }
      }
    };

    /**
     * Populates the pager with proper amount of pages
     */
    var populatePager = function() {
      var pagerHtml = '',
      linkContent = '',
      pagerQty = getPagerQty();
      // loop through each pager item
      for (var i = 0; i < pagerQty; i++) {
        linkContent = '';
        // if a buildPager function is supplied, use it to get pager link value, else use index + 1
        if (slider.settings.buildPager && $.isFunction(slider.settings.buildPager) || slider.settings.pagerCustom) {
          linkContent = slider.settings.buildPager(i);
          slider.pagerEl.addClass('bx-custom-pager');
        } else {
          linkContent = i + 1;
          slider.pagerEl.addClass('bx-default-pager');
        }
        // var linkContent = slider.settings.buildPager && $.isFunction(slider.settings.buildPager) ? slider.settings.buildPager(i) : i + 1;
        // add the markup to the string
        pagerHtml += '<div class="bx-pager-item"><a href="" data-slide-index="' + i + '" class="bx-pager-link">' + linkContent + '</a></div>';
      }
      // populate the pager element with pager links
      slider.pagerEl.html(pagerHtml);
    };

    /**
     * Appends the pager to the controls element
     */
    var appendPager = function() {
      if (!slider.settings.pagerCustom) {
        // create the pager DOM element
        slider.pagerEl = $('<div class="bx-pager" />');
        // if a pager selector was supplied, populate it with the pager
        if (slider.settings.pagerSelector) {
          $(slider.settings.pagerSelector).html(slider.pagerEl);
        // if no pager selector was supplied, add it after the wrapper
        } else {
          slider.controls.el.addClass('bx-has-pager').append(slider.pagerEl);
        }
        // populate the pager
        populatePager();
      } else {
        slider.pagerEl = $(slider.settings.pagerCustom);
      }
      // assign the pager click binding
      slider.pagerEl.on('click touchend', 'a', clickPagerBind);
    };

    /**
     * Appends prev / next controls to the controls element
     */
    var appendControls = function() {
      slider.controls.next = $('<a class="bx-next" href="">' + slider.settings.nextText + '</a>');
      slider.controls.prev = $('<a class="bx-prev" href="">' + slider.settings.prevText + '</a>');
      // bind click actions to the controls
      slider.controls.next.bind('click touchend', clickNextBind);
      slider.controls.prev.bind('click touchend', clickPrevBind);
      // if nextSelector was supplied, populate it
      if (slider.settings.nextSelector) {
        $(slider.settings.nextSelector).append(slider.controls.next);
      }
      // if prevSelector was supplied, populate it
      if (slider.settings.prevSelector) {
        $(slider.settings.prevSelector).append(slider.controls.prev);
      }
      // if no custom selectors were supplied
      if (!slider.settings.nextSelector && !slider.settings.prevSelector) {
        // add the controls to the DOM
        slider.controls.directionEl = $('<div class="bx-controls-direction" />');
        // add the control elements to the directionEl
        slider.controls.directionEl.append(slider.controls.prev).append(slider.controls.next);
        // slider.viewport.append(slider.controls.directionEl);
        slider.controls.el.addClass('bx-has-controls-direction').append(slider.controls.directionEl);
      }
    };

    /**
     * Appends start / stop auto controls to the controls element
     */
    var appendControlsAuto = function() {
      slider.controls.start = $('<div class="bx-controls-auto-item"><a class="bx-start" href="">' + slider.settings.startText + '</a></div>');
      slider.controls.stop = $('<div class="bx-controls-auto-item"><a class="bx-stop" href="">' + slider.settings.stopText + '</a></div>');
      // add the controls to the DOM
      slider.controls.autoEl = $('<div class="bx-controls-auto" />');
      // bind click actions to the controls
      slider.controls.autoEl.on('click', '.bx-start', clickStartBind);
      slider.controls.autoEl.on('click', '.bx-stop', clickStopBind);
      // if autoControlsCombine, insert only the "start" control
      if (slider.settings.autoControlsCombine) {
        slider.controls.autoEl.append(slider.controls.start);
      // if autoControlsCombine is false, insert both controls
      } else {
        slider.controls.autoEl.append(slider.controls.start).append(slider.controls.stop);
      }
      // if auto controls selector was supplied, populate it with the controls
      if (slider.settings.autoControlsSelector) {
        $(slider.settings.autoControlsSelector).html(slider.controls.autoEl);
      // if auto controls selector was not supplied, add it after the wrapper
      } else {
        slider.controls.el.addClass('bx-has-controls-auto').append(slider.controls.autoEl);
      }
      // update the auto controls
      updateAutoControls(slider.settings.autoStart ? 'stop' : 'start');
    };

    /**
     * Appends image captions to the DOM
     */
    var appendCaptions = function() {
      // cycle through each child
      slider.children.each(function(index) {
        // get the image title attribute
        var title = $(this).find('img:first').attr('title');
        // append the caption
        if (title !== undefined && ('' + title).length) {
          $(this).append('<div class="bx-caption"><span>' + title + '</span></div>');
        }
      });
    };

    /**
     * Click next binding
     *
     * @param e (event)
     *  - DOM event object
     */
    var clickNextBind = function(e) {
      e.preventDefault();
      if (slider.controls.el.hasClass('disabled')) { return; }
      // if auto show is running, stop it
      if (slider.settings.auto && slider.settings.stopAutoOnClick) { el.stopAuto(); }
      el.goToNextSlide();
    };

    /**
     * Click prev binding
     *
     * @param e (event)
     *  - DOM event object
     */
    var clickPrevBind = function(e) {
      e.preventDefault();
      if (slider.controls.el.hasClass('disabled')) { return; }
      // if auto show is running, stop it
      if (slider.settings.auto && slider.settings.stopAutoOnClick) { el.stopAuto(); }
      el.goToPrevSlide();
    };

    /**
     * Click start binding
     *
     * @param e (event)
     *  - DOM event object
     */
    var clickStartBind = function(e) {
      el.startAuto();
      e.preventDefault();
    };

    /**
     * Click stop binding
     *
     * @param e (event)
     *  - DOM event object
     */
    var clickStopBind = function(e) {
      el.stopAuto();
      e.preventDefault();
    };

    /**
     * Click pager binding
     *
     * @param e (event)
     *  - DOM event object
     */
    var clickPagerBind = function(e) {
      var pagerLink, pagerIndex;
      e.preventDefault();
      if (slider.controls.el.hasClass('disabled')) {
        return;
      }
      // if auto show is running, stop it
      if (slider.settings.auto  && slider.settings.stopAutoOnClick) { el.stopAuto(); }
      pagerLink = $(e.currentTarget);
      if (pagerLink.attr('data-slide-index') !== undefined) {
        pagerIndex = parseInt(pagerLink.attr('data-slide-index'));
        // if clicked pager link is not active, continue with the goToSlide call
        if (pagerIndex !== slider.active.index) { el.goToSlide(pagerIndex); }
      }
    };

    /**
     * Updates the pager links with an active class
     *
     * @param slideIndex (int)
     *  - index of slide to make active
     */
    var updatePagerActive = function(slideIndex) {
      // if "short" pager type
      var len = slider.children.length; // nb of children
      if (slider.settings.pagerType === 'short') {
        if (slider.settings.maxSlides > 1) {
          len = Math.ceil(slider.children.length / slider.settings.maxSlides);
        }
        slider.pagerEl.html((slideIndex + 1) + slider.settings.pagerShortSeparator + len);
        return;
      }
      // remove all pager active classes
      slider.pagerEl.find('a').removeClass('active');
      // apply the active class for all pagers
      slider.pagerEl.each(function(i, el) { $(el).find('a').eq(slideIndex).addClass('active'); });
    };

    /**
     * Performs needed actions after a slide transition
     */
    var updateAfterSlideTransition = function() {
      // if infinite loop is true
      if (slider.settings.infiniteLoop) {
        var position = '';
        // first slide
        if (slider.active.index === 0) {
          // set the new position
          position = slider.children.eq(0).position();
        // carousel, last slide
        } else if (slider.active.index === getPagerQty() - 1 && slider.carousel) {
          position = slider.children.eq((getPagerQty() - 1) * getMoveBy()).position();
        // last slide
        } else if (slider.active.index === slider.children.length - 1) {
          position = slider.children.eq(slider.children.length - 1).position();
        }
        if (position) {
          if (slider.settings.mode === 'horizontal') { setPositionProperty(-position.left, 'reset', 0); }
          else if (slider.settings.mode === 'vertical') { setPositionProperty(-position.top, 'reset', 0); }
        }
      }
      // declare that the transition is complete
      slider.working = false;
      // onSlideAfter callback
      slider.settings.onSlideAfter.call(el, slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
    };

    /**
     * Updates the auto controls state (either active, or combined switch)
     *
     * @param state (string) "start", "stop"
     *  - the new state of the auto show
     */
    var updateAutoControls = function(state) {
      // if autoControlsCombine is true, replace the current control with the new state
      if (slider.settings.autoControlsCombine) {
        slider.controls.autoEl.html(slider.controls[state]);
      // if autoControlsCombine is false, apply the "active" class to the appropriate control
      } else {
        slider.controls.autoEl.find('a').removeClass('active');
        slider.controls.autoEl.find('a:not(.bx-' + state + ')').addClass('active');
      }
    };

    /**
     * Updates the direction controls (checks if either should be hidden)
     */
    var updateDirectionControls = function() {
      if (getPagerQty() === 1) {
        slider.controls.prev.addClass('disabled');
        slider.controls.next.addClass('disabled');
      } else if (!slider.settings.infiniteLoop && slider.settings.hideControlOnEnd) {
        // if first slide
        if (slider.active.index === 0) {
          slider.controls.prev.addClass('disabled');
          slider.controls.next.removeClass('disabled');
        // if last slide
        } else if (slider.active.index === getPagerQty() - 1) {
          slider.controls.next.addClass('disabled');
          slider.controls.prev.removeClass('disabled');
        // if any slide in the middle
        } else {
          slider.controls.prev.removeClass('disabled');
          slider.controls.next.removeClass('disabled');
        }
      }
    };

    /**
     * Initializes the auto process
     */
    var initAuto = function() {
      // if autoDelay was supplied, launch the auto show using a setTimeout() call
      if (slider.settings.autoDelay > 0) {
        var timeout = setTimeout(el.startAuto, slider.settings.autoDelay);
      // if autoDelay was not supplied, start the auto show normally
      } else {
        el.startAuto();

        //add focus and blur events to ensure its running if timeout gets paused
        $(window).focus(function() {
          el.startAuto();
        }).blur(function() {
          el.stopAuto();
        });
      }
      // if autoHover is requested
      if (slider.settings.autoHover) {
        // on el hover
        el.hover(function() {
          // if the auto show is currently playing (has an active interval)
          if (slider.interval) {
            // stop the auto show and pass true argument which will prevent control update
            el.stopAuto(true);
            // create a new autoPaused value which will be used by the relative "mouseout" event
            slider.autoPaused = true;
          }
        }, function() {
          // if the autoPaused value was created be the prior "mouseover" event
          if (slider.autoPaused) {
            // start the auto show and pass true argument which will prevent control update
            el.startAuto(true);
            // reset the autoPaused value
            slider.autoPaused = null;
          }
        });
      }
    };

    /**
     * Initializes the ticker process
     */
    var initTicker = function() {
      var startPosition = 0,
      position, transform, value, idx, ratio, property, newSpeed, totalDimens;
      // if autoDirection is "next", append a clone of the entire slider
      if (slider.settings.autoDirection === 'next') {
        el.append(slider.children.clone().addClass('bx-clone'));
      // if autoDirection is "prev", prepend a clone of the entire slider, and set the left position
      } else {
        el.prepend(slider.children.clone().addClass('bx-clone'));
        position = slider.children.first().position();
        startPosition = slider.settings.mode === 'horizontal' ? -position.left : -position.top;
      }
      setPositionProperty(startPosition, 'reset', 0);
      // do not allow controls in ticker mode
      slider.settings.pager = false;
      slider.settings.controls = false;
      slider.settings.autoControls = false;
      // if autoHover is requested
      if (slider.settings.tickerHover) {
        if (slider.usingCSS) {
          idx = slider.settings.mode === 'horizontal' ? 4 : 5;
          slider.viewport.hover(function() {
            transform = el.css('-' + slider.cssPrefix + '-transform');
            value = parseFloat(transform.split(',')[idx]);
            setPositionProperty(value, 'reset', 0);
          }, function() {
            totalDimens = 0;
            slider.children.each(function(index) {
              totalDimens += slider.settings.mode === 'horizontal' ? $(this).outerWidth(true) : $(this).outerHeight(true);
            });
            // calculate the speed ratio (used to determine the new speed to finish the paused animation)
            ratio = slider.settings.speed / totalDimens;
            // determine which property to use
            property = slider.settings.mode === 'horizontal' ? 'left' : 'top';
            // calculate the new speed
            newSpeed = ratio * (totalDimens - (Math.abs(parseInt(value))));
            tickerLoop(newSpeed);
          });
        } else {
          // on el hover
          slider.viewport.hover(function() {
            el.stop();
          }, function() {
            // calculate the total width of children (used to calculate the speed ratio)
            totalDimens = 0;
            slider.children.each(function(index) {
              totalDimens += slider.settings.mode === 'horizontal' ? $(this).outerWidth(true) : $(this).outerHeight(true);
            });
            // calculate the speed ratio (used to determine the new speed to finish the paused animation)
            ratio = slider.settings.speed / totalDimens;
            // determine which property to use
            property = slider.settings.mode === 'horizontal' ? 'left' : 'top';
            // calculate the new speed
            newSpeed = ratio * (totalDimens - (Math.abs(parseInt(el.css(property)))));
            tickerLoop(newSpeed);
          });
        }
      }
      // start the ticker loop
      tickerLoop();
    };

    /**
     * Runs a continuous loop, news ticker-style
     */
    var tickerLoop = function(resumeSpeed) {
      var speed = resumeSpeed ? resumeSpeed : slider.settings.speed,
      position = {left: 0, top: 0},
      reset = {left: 0, top: 0},
      animateProperty, resetValue, params;

      // if "next" animate left position to last child, then reset left to 0
      if (slider.settings.autoDirection === 'next') {
        position = el.find('.bx-clone').first().position();
      // if "prev" animate left position to 0, then reset left to first non-clone child
      } else {
        reset = slider.children.first().position();
      }
      animateProperty = slider.settings.mode === 'horizontal' ? -position.left : -position.top;
      resetValue = slider.settings.mode === 'horizontal' ? -reset.left : -reset.top;
      params = {resetValue: resetValue};
      setPositionProperty(animateProperty, 'ticker', speed, params);
    };

    /**
     * Check if el is on screen
     */
    var isOnScreen = function(el) {
      var win = $(window),
      viewport = {
        top: win.scrollTop(),
        left: win.scrollLeft()
      },
      bounds = el.offset();

      viewport.right = viewport.left + win.width();
      viewport.bottom = viewport.top + win.height();
      bounds.right = bounds.left + el.outerWidth();
      bounds.bottom = bounds.top + el.outerHeight();

      return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));
    };

    /**
     * Initializes keyboard events
     */
    var keyPress = function(e) {
      var activeElementTag = document.activeElement.tagName.toLowerCase(),
      tagFilters = 'input|textarea',
      p = new RegExp(activeElementTag,['i']),
      result = p.exec(tagFilters);

      if (result == null && isOnScreen(el)) {
        if (e.keyCode === 39) {
          clickNextBind(e);
          return false;
        } else if (e.keyCode === 37) {
          clickPrevBind(e);
          return false;
        }
      }
    };

    /**
     * Initializes touch events
     */
    var initTouch = function() {
      // initialize object to contain all touch values
      slider.touch = {
        start: {x: 0, y: 0},
        end: {x: 0, y: 0}
      };
      slider.viewport.bind('touchstart MSPointerDown pointerdown', onTouchStart);

      //for browsers that have implemented pointer events and fire a click after
      //every pointerup regardless of whether pointerup is on same screen location as pointerdown or not
      slider.viewport.on('click', '.bxslider a', function(e) {
        if (slider.viewport.hasClass('click-disabled')) {
          e.preventDefault();
          slider.viewport.removeClass('click-disabled');
        }
      });
    };

    /**
     * Event handler for "touchstart"
     *
     * @param e (event)
     *  - DOM event object
     */
    var onTouchStart = function(e) {
      //disable slider controls while user is interacting with slides to avoid slider freeze that happens on touch devices when a slide swipe happens immediately after interacting with slider controls
      slider.controls.el.addClass('disabled');

      if (slider.working) {
        e.preventDefault();
        slider.controls.el.removeClass('disabled');
      } else {
        // record the original position when touch starts
        slider.touch.originalPos = el.position();
        var orig = e.originalEvent,
        touchPoints = (typeof orig.changedTouches !== 'undefined') ? orig.changedTouches : [orig];
        // record the starting touch x, y coordinates
        slider.touch.start.x = touchPoints[0].pageX;
        slider.touch.start.y = touchPoints[0].pageY;

        if (slider.viewport.get(0).setPointerCapture) {
          slider.pointerId = orig.pointerId;
          slider.viewport.get(0).setPointerCapture(slider.pointerId);
        }
        // bind a "touchmove" event to the viewport
        slider.viewport.bind('touchmove MSPointerMove pointermove', onTouchMove);
        // bind a "touchend" event to the viewport
        slider.viewport.bind('touchend MSPointerUp pointerup', onTouchEnd);
        slider.viewport.bind('MSPointerCancel pointercancel', onPointerCancel);
      }
    };

    /**
     * Cancel Pointer for Windows Phone
     *
     * @param e (event)
     *  - DOM event object
     */
    var onPointerCancel = function(e) {
      /* onPointerCancel handler is needed to deal with situations when a touchend
      doesn't fire after a touchstart (this happens on windows phones only) */
      setPositionProperty(slider.touch.originalPos.left, 'reset', 0);

      //remove handlers
      slider.controls.el.removeClass('disabled');
      slider.viewport.unbind('MSPointerCancel pointercancel', onPointerCancel);
      slider.viewport.unbind('touchmove MSPointerMove pointermove', onTouchMove);
      slider.viewport.unbind('touchend MSPointerUp pointerup', onTouchEnd);
      if (slider.viewport.get(0).releasePointerCapture) {
        slider.viewport.get(0).releasePointerCapture(slider.pointerId);
      }
    };

    /**
     * Event handler for "touchmove"
     *
     * @param e (event)
     *  - DOM event object
     */
    var onTouchMove = function(e) {
      var orig = e.originalEvent,
      touchPoints = (typeof orig.changedTouches !== 'undefined') ? orig.changedTouches : [orig],
      // if scrolling on y axis, do not prevent default
      xMovement = Math.abs(touchPoints[0].pageX - slider.touch.start.x),
      yMovement = Math.abs(touchPoints[0].pageY - slider.touch.start.y),
      value = 0,
      change = 0;

      // x axis swipe
      if ((xMovement * 3) > yMovement && slider.settings.preventDefaultSwipeX) {
        e.preventDefault();
      // y axis swipe
      } else if ((yMovement * 3) > xMovement && slider.settings.preventDefaultSwipeY) {
        e.preventDefault();
      }
      if (slider.settings.mode !== 'fade' && slider.settings.oneToOneTouch) {
        // if horizontal, drag along x axis
        if (slider.settings.mode === 'horizontal') {
          change = touchPoints[0].pageX - slider.touch.start.x;
          value = slider.touch.originalPos.left + change;
        // if vertical, drag along y axis
        } else {
          change = touchPoints[0].pageY - slider.touch.start.y;
          value = slider.touch.originalPos.top + change;
        }
        setPositionProperty(value, 'reset', 0);
      }
    };

    /**
     * Event handler for "touchend"
     *
     * @param e (event)
     *  - DOM event object
     */
    var onTouchEnd = function(e) {
      slider.viewport.unbind('touchmove MSPointerMove pointermove', onTouchMove);
      //enable slider controls as soon as user stops interacing with slides
      slider.controls.el.removeClass('disabled');
      var orig    = e.originalEvent,
      touchPoints = (typeof orig.changedTouches !== 'undefined') ? orig.changedTouches : [orig],
      value       = 0,
      distance    = 0;
      // record end x, y positions
      slider.touch.end.x = touchPoints[0].pageX;
      slider.touch.end.y = touchPoints[0].pageY;
      // if fade mode, check if absolute x distance clears the threshold
      if (slider.settings.mode === 'fade') {
        distance = Math.abs(slider.touch.start.x - slider.touch.end.x);
        if (distance >= slider.settings.swipeThreshold) {
          if (slider.touch.start.x > slider.touch.end.x) {
            el.goToNextSlide();
          } else {
            el.goToPrevSlide();
          }
          el.stopAuto();
        }
      // not fade mode
      } else {
        // calculate distance and el's animate property
        if (slider.settings.mode === 'horizontal') {
          distance = slider.touch.end.x - slider.touch.start.x;
          value = slider.touch.originalPos.left;
        } else {
          distance = slider.touch.end.y - slider.touch.start.y;
          value = slider.touch.originalPos.top;
        }
        // if not infinite loop and first / last slide, do not attempt a slide transition
        if (!slider.settings.infiniteLoop && ((slider.active.index === 0 && distance > 0) || (slider.active.last && distance < 0))) {
          setPositionProperty(value, 'reset', 200);
        } else {
          // check if distance clears threshold
          if (Math.abs(distance) >= slider.settings.swipeThreshold) {
            if (distance < 0) {
              el.goToNextSlide();
            } else {
              el.goToPrevSlide();
            }
            el.stopAuto();
          } else {
            // el.animate(property, 200);
            setPositionProperty(value, 'reset', 200);
          }
        }
      }
      slider.viewport.unbind('touchend MSPointerUp pointerup', onTouchEnd);
      if (slider.viewport.get(0).releasePointerCapture) {
        slider.viewport.get(0).releasePointerCapture(slider.pointerId);
      }
    };

    /**
     * Window resize event callback
     */
    var resizeWindow = function(e) {
      // don't do anything if slider isn't initialized.
      if (!slider.initialized) { return; }
      // Delay if slider working.
      if (slider.working) {
        window.setTimeout(resizeWindow, 10);
      } else {
        // get the new window dimens (again, thank you IE)
        var windowWidthNew = $(window).width(),
        windowHeightNew = $(window).height();
        // make sure that it is a true window resize
        // *we must check this because our dinosaur friend IE fires a window resize event when certain DOM elements
        // are resized. Can you just die already?*
        if (windowWidth !== windowWidthNew || windowHeight !== windowHeightNew) {
          // set the new window dimens
          windowWidth = windowWidthNew;
          windowHeight = windowHeightNew;
          // update all dynamic elements
          el.redrawSlider();
          // Call user resize handler
          slider.settings.onSliderResize.call(el, slider.active.index);
        }
      }
    };

    /**
     * Adds an aria-hidden=true attribute to each element
     *
     * @param startVisibleIndex (int)
     *  - the first visible element's index
     */
    var applyAriaHiddenAttributes = function(startVisibleIndex) {
      var numberOfSlidesShowing = getNumberSlidesShowing();
      // only apply attributes if the setting is enabled and not in ticker mode
      if (slider.settings.ariaHidden && !slider.settings.ticker) {
        // add aria-hidden=true to all elements
        slider.children.attr('aria-hidden', 'true');
        // get the visible elements and change to aria-hidden=false
        slider.children.slice(startVisibleIndex, startVisibleIndex + numberOfSlidesShowing).attr('aria-hidden', 'false');
      }
    };

    /**
     * Returns index according to present page range
     *
     * @param slideOndex (int)
     *  - the desired slide index
     */
    var setSlideIndex = function(slideIndex) {
      if (slideIndex < 0) {
        if (slider.settings.infiniteLoop) {
          return getPagerQty() - 1;
        }else {
          //we don't go to undefined slides
          return slider.active.index;
        }
      // if slideIndex is greater than children length, set active index to 0 (this happens during infinite loop)
      } else if (slideIndex >= getPagerQty()) {
        if (slider.settings.infiniteLoop) {
          return 0;
        } else {
          //we don't move to undefined pages
          return slider.active.index;
        }
      // set active index to requested slide
      } else {
        return slideIndex;
      }
    };

    /**
     * ===================================================================================
     * = PUBLIC FUNCTIONS
     * ===================================================================================
     */

    /**
     * Performs slide transition to the specified slide
     *
     * @param slideIndex (int)
     *  - the destination slide's index (zero-based)
     *
     * @param direction (string)
     *  - INTERNAL USE ONLY - the direction of travel ("prev" / "next")
     */
    el.goToSlide = function(slideIndex, direction) {
      // onSlideBefore, onSlideNext, onSlidePrev callbacks
      // Allow transition canceling based on returned value
      var performTransition = true,
      moveBy = 0,
      position = {left: 0, top: 0},
      lastChild = null,
      lastShowingIndex, eq, value, requestEl;
      // store the old index
      slider.oldIndex = slider.active.index;
      //set new index
      slider.active.index = setSlideIndex(slideIndex);

      // if plugin is currently in motion, ignore request
      if (slider.working || slider.active.index === slider.oldIndex) { return; }
      // declare that plugin is in motion
      slider.working = true;

      performTransition = slider.settings.onSlideBefore.call(el, slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);

      // If transitions canceled, reset and return
      if (typeof (performTransition) !== 'undefined' && !performTransition) {
        slider.active.index = slider.oldIndex; // restore old index
        slider.working = false; // is not in motion
        return;
      }

      if (direction === 'next') {
        // Prevent canceling in future functions or lack there-of from negating previous commands to cancel
        if (!slider.settings.onSlideNext.call(el, slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index)) {
          performTransition = false;
        }
      } else if (direction === 'prev') {
        // Prevent canceling in future functions or lack there-of from negating previous commands to cancel
        if (!slider.settings.onSlidePrev.call(el, slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index)) {
          performTransition = false;
        }
      }

      // check if last slide
      slider.active.last = slider.active.index >= getPagerQty() - 1;
      // update the pager with active class
      if (slider.settings.pager || slider.settings.pagerCustom) { updatePagerActive(slider.active.index); }
      // // check for direction control update
      if (slider.settings.controls) { updateDirectionControls(); }
      // if slider is set to mode: "fade"
      if (slider.settings.mode === 'fade') {
        // if adaptiveHeight is true and next height is different from current height, animate to the new height
        if (slider.settings.adaptiveHeight && slider.viewport.height() !== getViewportHeight()) {
          slider.viewport.animate({height: getViewportHeight()}, slider.settings.adaptiveHeightSpeed);
        }
        // fade out the visible child and reset its z-index value
        slider.children.filter(':visible').fadeOut(slider.settings.speed).css({zIndex: 0});
        // fade in the newly requested slide
        slider.children.eq(slider.active.index).css('zIndex', slider.settings.slideZIndex + 1).fadeIn(slider.settings.speed, function() {
          $(this).css('zIndex', slider.settings.slideZIndex);
          updateAfterSlideTransition();
        });
      // slider mode is not "fade"
      } else {
        // if adaptiveHeight is true and next height is different from current height, animate to the new height
        if (slider.settings.adaptiveHeight && slider.viewport.height() !== getViewportHeight()) {
          slider.viewport.animate({height: getViewportHeight()}, slider.settings.adaptiveHeightSpeed);
        }
        // if carousel and not infinite loop
        if (!slider.settings.infiniteLoop && slider.carousel && slider.active.last) {
          if (slider.settings.mode === 'horizontal') {
            // get the last child position
            lastChild = slider.children.eq(slider.children.length - 1);
            position = lastChild.position();
            // calculate the position of the last slide
            moveBy = slider.viewport.width() - lastChild.outerWidth();
          } else {
            // get last showing index position
            lastShowingIndex = slider.children.length - slider.settings.minSlides;
            position = slider.children.eq(lastShowingIndex).position();
          }
          // horizontal carousel, going previous while on first slide (infiniteLoop mode)
        } else if (slider.carousel && slider.active.last && direction === 'prev') {
          // get the last child position
          eq = slider.settings.moveSlides === 1 ? slider.settings.maxSlides - getMoveBy() : ((getPagerQty() - 1) * getMoveBy()) - (slider.children.length - slider.settings.maxSlides);
          lastChild = el.children('.bx-clone').eq(eq);
          position = lastChild.position();
        // if infinite loop and "Next" is clicked on the last slide
        } else if (direction === 'next' && slider.active.index === 0) {
          // get the last clone position
          position = el.find('> .bx-clone').eq(slider.settings.maxSlides).position();
          slider.active.last = false;
        // normal non-zero requests
        } else if (slideIndex >= 0) {
          //parseInt is applied to allow floats for slides/page
          requestEl = slideIndex * parseInt(getMoveBy());
          position = slider.children.eq(requestEl).position();
        }

        /* If the position doesn't exist
         * (e.g. if you destroy the slider on a next click),
         * it doesn't throw an error.
         */
        if (typeof (position) !== 'undefined') {
          value = slider.settings.mode === 'horizontal' ? -(position.left - moveBy) : -position.top;
          // plugin values to be animated
          setPositionProperty(value, 'slide', slider.settings.speed);
        } else {
          slider.working = false;
        }
      }
      if (slider.settings.ariaHidden) { applyAriaHiddenAttributes(slider.active.index * getMoveBy()); }
    };

    /**
     * Transitions to the next slide in the show
     */
    el.goToNextSlide = function() {
      // if infiniteLoop is false and last page is showing, disregard call
      if (!slider.settings.infiniteLoop && slider.active.last) { return; }
      var pagerIndex = parseInt(slider.active.index) + 1;
      el.goToSlide(pagerIndex, 'next');
    };

    /**
     * Transitions to the prev slide in the show
     */
    el.goToPrevSlide = function() {
      // if infiniteLoop is false and last page is showing, disregard call
      if (!slider.settings.infiniteLoop && slider.active.index === 0) { return; }
      var pagerIndex = parseInt(slider.active.index) - 1;
      el.goToSlide(pagerIndex, 'prev');
    };

    /**
     * Starts the auto show
     *
     * @param preventControlUpdate (boolean)
     *  - if true, auto controls state will not be updated
     */
    el.startAuto = function(preventControlUpdate) {
      // if an interval already exists, disregard call
      if (slider.interval) { return; }
      // create an interval
      slider.interval = setInterval(function() {
        if (slider.settings.autoDirection === 'next') {
          el.goToNextSlide();
        } else {
          el.goToPrevSlide();
        }
      }, slider.settings.pause);
      // if auto controls are displayed and preventControlUpdate is not true
      if (slider.settings.autoControls && preventControlUpdate !== true) { updateAutoControls('stop'); }
    };

    /**
     * Stops the auto show
     *
     * @param preventControlUpdate (boolean)
     *  - if true, auto controls state will not be updated
     */
    el.stopAuto = function(preventControlUpdate) {
      // if no interval exists, disregard call
      if (!slider.interval) { return; }
      // clear the interval
      clearInterval(slider.interval);
      slider.interval = null;
      // if auto controls are displayed and preventControlUpdate is not true
      if (slider.settings.autoControls && preventControlUpdate !== true) { updateAutoControls('start'); }
    };

    /**
     * Returns current slide index (zero-based)
     */
    el.getCurrentSlide = function() {
      return slider.active.index;
    };

    /**
     * Returns current slide element
     */
    el.getCurrentSlideElement = function() {
      return slider.children.eq(slider.active.index);
    };

    /**
     * Returns a slide element
     * @param index (int)
     *  - The index (zero-based) of the element you want returned.
     */
    el.getSlideElement = function(index) {
      return slider.children.eq(index);
    };

    /**
     * Returns number of slides in show
     */
    el.getSlideCount = function() {
      return slider.children.length;
    };

    /**
     * Return slider.working variable
     */
    el.isWorking = function() {
      return slider.working;
    };

    /**
     * Update all dynamic slider elements
     */
    el.redrawSlider = function() {
      // resize all children in ratio to new screen size
      slider.children.add(el.find('.bx-clone')).outerWidth(getSlideWidth());
      // adjust the height
      slider.viewport.css('height', getViewportHeight());
      // update the slide position
      if (!slider.settings.ticker) { setSlidePosition(); }
      // if active.last was true before the screen resize, we want
      // to keep it last no matter what screen size we end on
      if (slider.active.last) { slider.active.index = getPagerQty() - 1; }
      // if the active index (page) no longer exists due to the resize, simply set the index as last
      if (slider.active.index >= getPagerQty()) { slider.active.last = true; }
      // if a pager is being displayed and a custom pager is not being used, update it
      if (slider.settings.pager && !slider.settings.pagerCustom) {
        populatePager();
        updatePagerActive(slider.active.index);
      }
      if (slider.settings.ariaHidden) { applyAriaHiddenAttributes(slider.active.index * getMoveBy()); }
    };

    /**
     * Destroy the current instance of the slider (revert everything back to original state)
     */
    el.destroySlider = function() {
      // don't do anything if slider has already been destroyed
      if (!slider.initialized) { return; }
      slider.initialized = false;
      $('.bx-clone', this).remove();
      slider.children.each(function() {
        if ($(this).data('origStyle') !== undefined) {
          $(this).attr('style', $(this).data('origStyle'));
        } else {
          $(this).removeAttr('style');
        }
      });
      if ($(this).data('origStyle') !== undefined) {
        this.attr('style', $(this).data('origStyle'));
      } else {
        $(this).removeAttr('style');
      }
      $(this).unwrap().unwrap();
      if (slider.controls.el) { slider.controls.el.remove(); }
      if (slider.controls.next) { slider.controls.next.remove(); }
      if (slider.controls.prev) { slider.controls.prev.remove(); }
      if (slider.pagerEl && slider.settings.controls && !slider.settings.pagerCustom) { slider.pagerEl.remove(); }
      $('.bx-caption', this).remove();
      if (slider.controls.autoEl) { slider.controls.autoEl.remove(); }
      clearInterval(slider.interval);
      if (slider.settings.responsive) { $(window).unbind('resize', resizeWindow); }
      if (slider.settings.keyboardEnabled) { $(document).unbind('keydown', keyPress); }
      //remove self reference in data
      $(this).removeData('bxSlider');
    };

    /**
     * Reload the slider (revert all DOM changes, and re-initialize)
     */
    el.reloadSlider = function(settings) {
      if (settings !== undefined) { options = settings; }
      el.destroySlider();
      init();
      //store reference to self in order to access public functions later
      $(el).data('bxSlider', this);
    };

    init();

    $(el).data('bxSlider', this);

    // returns the current jQuery object
    return this;
  };

})(jQuery);</script><style type="text/css"></style><div id="content" class="content"><h1 class="category-header">Popular Products</h1> <ul class="listing"><li class="first"><a href="/products/prod:tbs_unifypro_nano" x-ga-id='2029' x-ga-pos='1' ><img class="product" src="/img/gallery/thumb/1DSC00519-ga.jpg" />
<p><b>TBS Unify Pro Nano 5G8</b><br />
<em>19.95 USD</em></p></a></li><li><a href="/products/prod:crossfire_nano_se" x-ga-id='2028' x-ga-pos='2' ><img class="product" src="/img/gallery/thumb/b4g1f special DSC01030-ga.jpg" />
<p><b>TBS Crossfire Nano Rx (SE) - FPV LONG RANGE DRONE RECEIVER</b><br />
<em>29.95 USD</em></p></a></li><li><a href="/products/prod:unify_pro_hv_race" x-ga-id='1203' x-ga-pos='3' ><img class="product" src="/img/gallery/thumb/DSC01110111race-ga.jpg" />
<p><b>TBS Unify Pro 5G8 HV Race (SMA)</b><br />
<em>24.95 USD</em></p></a></li> </ul> <ul class="listing"><li class="first"><a href="/products/prod:unify_pro_hv_sma" x-ga-id='1200' x-ga-pos='4' ><img class="product" src="/img/gallery/thumb/A7300562.JPG" />
<p><b>TBS Unify Pro 5G8 HV (SMA)</b><br />
<em>49.95 USD</em></p></a></li><li><a href="/products/prod:unify_pro_hv" x-ga-id='967' x-ga-pos='5' ><img class="product" src="/img/gallery/thumb/rpsmaA7300562.jpg" />
<p><b>TBS Unify Pro 5G8 HV (RP-SMA)</b><br />
<em>49.95 USD</em></p></a></li><li><a href="/products/prod:tbs_fusion" x-ga-id='3425' x-ga-pos='6' ><img class="product" src="/img/gallery/thumb/A7300617.JPG" />
<p><b>TBS Fusion</b><br />
<em>119.95 USD</em></p></a></li> </ul> <ul class="listing"><li class="first"><a href="/products/prod:crown_jewels" x-ga-id='4342' x-ga-pos='7' ><img class="product" src="/img/gallery/thumb/A7301134.JPG" />
<p><b>TBS Crown Jewels M3</b><br />
<em>10.95 USD</em></p></a></li><li><a href="/products/prod:ethix_s3_props" x-ga-id='2671' x-ga-pos='8' ><img class="product" src="/img/gallery/thumb/DSC01473-ga.jpg" />
<p><b>Ethix S3 Watermelon Props</b><br />
<em>3.59 USD</em></p></a></li><li><a href="/products/prod:ndfilter_nd32" x-ga-id='2585' x-ga-pos='9' ><img class="product" src="/img/gallery/thumb/DSC0123432ga.jpg" />
<p><b>Glass ND Filters - ND32</b><br />
<em>4.95 USD</em></p></a></li> </ul></div><script type="text/javascript">
				gtag('event','view_item_list', 
					{
						"items": [{"id":"2029","price":"19.95","name":"TBS Unify Pro Nano 5G8","category":"FPV Equipment\/VTX\/5G8","list_name":"Homepage Popular","list_position":1},{"id":"2028","price":"29.95","name":"TBS Crossfire Nano Rx (SE) - FPV LONG RANGE DRONE RECEIVER","category":null,"list_name":"Homepage Popular","list_position":2},{"id":"1203","price":"24.95","name":"TBS Unify Pro 5G8 HV Race (SMA)","category":"FPV Equipment\/VTX\/5G8","list_name":"Homepage Popular","list_position":3},{"id":"1200","price":"49.95","name":"TBS Unify Pro 5G8 HV (SMA)","category":"FPV Equipment\/VTX\/5G8","list_name":"Homepage Popular","list_position":4},{"id":"967","price":"49.95","name":"TBS Unify Pro 5G8 HV (RP-SMA)","category":"FPV Equipment\/VTX\/5G8","list_name":"Homepage Popular","list_position":5},{"id":"3425","price":"119.95","name":"TBS Fusion","category":"FPV Equipment\/VRX\/5G8","list_name":"Homepage Popular","list_position":6},{"id":"4342","price":"10.95","name":"TBS Crown Jewels M3","category":"RC Link\/Radio\/Accessories","list_name":"Homepage Popular","list_position":7},{"id":"2671","price":"3.59","name":"Ethix S3 Watermelon Props","category":"ETHIX","list_name":"Homepage Popular","list_position":8},{"id":"2585","price":"4.95","name":"Glass ND Filters - ND32","category":"Hardware and Tools\/ND Filters","list_name":"Homepage Popular","list_position":9}],
						"list_name": 'Homepage Popular',
						"list_id": 'homepage_popular',
						"item_list_name": 'Homepage Popular',
						"item_list_id": 'homepage_popular',
					}
				);
				</script><script type="text/javascript">$(document).ready(function() {

	$('ul.variation').on("click", 'input', function() {
		var $this = $(this);
		if ($this.is(":checked")) {
			$.post(CMS_AJAX_URL, {'action':'loadvariation','a': 'cart','id': $(this).parents("li:first").attr('x-cms-id')}, function(r) {
				var snippet = $(r.html);
				snippet.hide();
				$this.parent().append(snippet);
				snippet.slideDown();
			},"json");
		} else {
			//$('ul.variation input',$this.parent()).attr('checked',false);
			// $('ul.variation input',$this.parent()).click();
			$($this.parent().children("ul.variation")).slideUp(function() { $(this).remove(); });
		}

		var price = getPrice($('input.qty').val());
		price = Math.round(price * 100 * $('input.qty').val()) / 100;
		writePrice(price);

	});

	$('input.qty').keyup(function() {
		if($(this).val() != ''){
			var qty = $(this).val();
			$('input.qty').val(qty);
			var price = getPrice($('input.qty').val());
			price = Math.round(price * 100 * $('input.qty').val()) / 100;
			writePrice(price);
		}
	});

	function writePrice(price) {
		$('p.total').text("US$ "+number_format(price,2,".",","))
	}

	function getPrice(qty) {
		var pricevariations = $('p.total').data('prices');
		if (qty == 1 || pricevariations.length == 0) {
			return ($('p.total').attr('x-numeric') * 1) + (getVariationPriceDiff());
		} else {
			var price = $('p.total').attr('x-numeric') * 1;

			for (var i=0;i<pricevariations.length;i++) {
				pricevariations[i].qty = pricevariations[i].qty * 1;

				if (pricevariations[i].qty > qty) break;
				if (pricevariations[i].qty <= qty) {
					price = pricevariations[i].price * 1;
				}
			}

			return price + getVariationPriceDiff();
		}
	}

	function getVariations() {
		var variations = [];
		$('ul.variation input:visible').each(function() {
			if ($(this).is(':checked')) {
				variations.push(this)
			}
		});
		return variations;
	}
	function getVariationIDs() {
		var variations = getVariations();

		var r = [];
		for (var i=0;i <variations.length;i++) {
			r.push(
				{
					id: $(variations[i]).attr('name').split("_")[1]
				}
			);
		}
		return r;
	}
	function getVariationPriceDiff() {
		var variations = getVariations();
		var price = 0;

		for (var i=0;i <variations.length;i++) {
			price = price + ($(variations[i]).val() * 1);
		}

		return price;
	}

});</script>    </div>
    <!-- Left thumbnails end -->


    <!-- Right column -->
    <div class="content_right triplecol">
	</div>
		</div>
		<div id="footer">
			<div class="content row">
				<div id="footer_sitemap2" style="text-align: center;" class="col-sm">
					<a href="/privacy" style="color: #666;font-size: 12px;">PRIVACY POLICY</a><br/>
					<a href="/about" style="color: #666;font-size: 12px;">LEGAL INFORMATION / IMPRESSUM</a>
				</div>
				<div id="footer_logo" class="col-sm">
					<a href="/"><img height="141" width="200" id="main_logo" src="/img/tbs_logo.svg" /></a>
				</div>
				<div id="footer_social" class="col-sm">
					<div class="w-100">
						<div class="w-100 py-2">Stay tuned, follow us:</div>
						<span>
							<a href="https://www.youtube.com/user/nastycop420" target="_blank"><img src="/img/YouTube.svg" /></a>
							<a href="https://www.facebook.com/groups/BlackSheepLOUNGE" target="_blank"><img src="/img/Facebook.svg" /></a>
							<a href="https://www.instagram.com/blacksheepfpv/" target="_blank"><img src="/img/Instagram.svg" /></a>
							<a href="https://plus.google.com/+nastycop420" target="_blank"><img src="/img/Google.svg" /></a>
							<a href="https://twitter.com/blacksheepfpv" target="_blank"><img src="/img/Twitter.svg" /></a>
						</span>
					</div>
					<div style="clear:both" class="w-100 pt-4 text-right">© 2023 TEAM BLACKSHEEP. All Rights Reserved.</div>
				</div>
			</div>
		</div>
	</span>

		<script src="/js/cms.js?v=1.4" type="text/javascript" defer></script>
<script src="/js/jquery.alerts.js?v=1.4" type="text/javascript" defer></script>
<script src="/js/slick.js?v=1.4" type="text/javascript" defer></script>
<script src="/js/jquery.mCustomScrollbar.concat.min.js?v=1.4" type="text/javascript" defer></script>
<script src="/js/bootstrap/bootstrap.min.js?v=1.4" type="text/javascript" defer></script>
<script src="/js/layoutv2.js?timeout=1678735741.4825?v=1.4" type="text/javascript" defer></script>
<script src="/js/prefixfree.min.js?v=1.4" type="text/javascript" defer></script>		<!-- SIDEBAR & Panels -->
		    <!-- jQuery Custom Scroller CDN -->
		    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

		    <script type="text/javascript">
		        $(document).ready(function () {
		        	if (getUrlParameter('reg')=="1") {
			        	$("#collapseLogin").collapse('show');
			        	$('#collapseLogin a[href="#registerTab"]').tab('show');
			        }
			        
		            $("#sidebar").mCustomScrollbar({
		                theme: "minimal"
		            });

		        	$("#menu_scroll").height($(window).height());

		            $('#dismiss, .overlay').on('click', function () {
		                $('#sidebar').removeClass('active');
		                $('.overlay').fadeOut();
		                $('html, body').css('overflowY', 'auto');
		                $('body').unbind('touchmove');
		            });

		            $('#sidebarCollapse').on('click', function () {
		            	closeCollapse();
		                $('#sidebar').addClass('active');
		                $('.overlay').fadeIn();
		                $('.collapse.in').toggleClass('in');
		                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
		                $('html, body').css('overflowY', 'hidden');
		                $('#sidebar').css('overflowY', 'auto');
		                $('#sidebar').unbind('touchmove');
		                $('body').bind('touchmove', function(e){e.preventDefault()});
		                $('#menu_scroll').on('touchmove', function (e) {e.stopPropagation();});
		            });

		            $('#collapseSearch').on('show.bs.collapse', function () {
		                //alert($('#search'));
		            	setTimeout(function() { $('#search').focus() }, 300);
		            });

		            setPanelPos();

		            setCartIconQty(0);

		        });

				function setCartIconQty(i) {
					if (i <= 0) {
		            	$('div#cart_qty').removeClass('cart_qty');
		            } else {
		            	$('#cart_qty').attr('data-count',i);
		            	$('div#cart_qty').addClass('cart_qty');
		            }
				}

				function closeSlidebar() {
					closeCollapse();
	                $('#sidebar').removeClass('active');
	                $('.overlay').fadeOut();
	                $('html, body').css('overflowY', 'auto');
	                $('body').unbind('touchmove');
	            }

				function closeCollapse() {
	                var $allPanel = $('#allPanel');
					$allPanel.find('.collapse.show').collapse('hide');
	            }

	            function showPanel(i) {
	            	$('html,body').animate({
				        scrollTop: 0
				    }, 500);

				    $('#'+i).collapse('show');
	            }

	            function gotoTop() {
	            	$('html,body').animate({
				        scrollTop: 0
				    }, 500);
	            }

	            function setPanelPos() {
	            	if ($(window).width() > 768) {
	            		$('#allPanel').offset({left:Math.min($(window).width(), 1202)+(Math.max(($(window).width()-1202)/2,0))-$('#allPanel').width()});
	        		}
	            	//$('#allPanel').offset({left:Math.min($(window).width(), 1202)+(Math.max(($(window).width()-1202)/2,0))-$('#allPanel').width()});
	            }
	            $(window).on('resize', function(){
				    //closeCollapse();
		    		setPanelPos();
		    		if ($(window).width() <= 767) {
						$('#product_detail').width(window.innerWidth);
						$('#category_listing_detail').width(window.innerWidth);
						//$('#product_detail').width(100%);
					} else {
						$('#product_detail').width(Math.min($('#product').width() - Math.max($('#navigation').width(),300),900));
						$('#category_listing_detail').width(Math.min($('#category_listing').width() - Math.max($('#navigation').width()-10,300),900));
					}
				});


				// Youtube set auto width
				$(function() {
					// Find all YouTube videos
					var $allVideos = $("iframe[src^='http://www.youtube.com']"),
					    // The element that is fluid width
					    $fluidE = $("#product_text"),
					    $fluidEl = $("#product"),
					    $fluidE2 = $("#navigation");
					// Figure out and save aspect ratio for each video
					$allVideos.each(function() {
						$(this)
							.data('aspectRatio', this.height / this.width)
							// and remove the hard coded width/height
							.removeAttr('height')
							.removeAttr('width');
					});

					// When the window is resized
					// (You'll probably want to debounce this)
					$(window).resize(function() {
						var newWidth = $fluidE.width();
						//var newWidth = Math.min($(window).width(), $fluidEl.width())-$fluidE2.width()-30;
						// Resize all videos according to their own aspect ratio
						$allVideos.each(function() {
							var $el = $(this);
							$el
								.width(newWidth)
								.height(newWidth * $el.data('aspectRatio'));
						});
					// Kick off one resize to fix all videos on page load
					}).resize();
				});

				function getUrlParameter(sParam) {
				    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
				        sURLVariables = sPageURL.split('&'),
				        sParameterName,
				        i;

				    for (i = 0; i < sURLVariables.length; i++) {
				        sParameterName = sURLVariables[i].split('=');

				        if (sParameterName[0] === sParam) {
				            return sParameterName[1] === undefined ? true : sParameterName[1];
				        }
				    }
				};

		    </script>
    	<!-- END SIDEBAR & Panels -->
    	<script type="text/javascript">var CMS_LANG = 'en';var CMS_AJAX_URL = '/';</script>
	<script>ga('send', 'pageview');</script>

<script type="text/javascript">

/*
$(document).ready(function() {
	$(document).on("click", '#mini_cart', function(e) {
		$this = $('#mini_cart');
		e.stopPropagation();

		if ($this.data("exposed") == true) {
			$this.data("exposed",false);
			$('#global_cart').slideUp(100);
		} else {
			var pos = $this.position();
			$('#global_cart').css({left: pos.left - 250,top: pos.top + 49}).show();
			$this.data("exposed",true);
			$('body').one("click",function() {$('#global_cart').slideUp(100,function() {$('#mini_cart').data("exposed",false);});});
		}
	});

});
*/

</script>
		</body>
		</html>

		